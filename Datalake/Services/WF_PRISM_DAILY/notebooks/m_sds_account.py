#Code converted on 2023-07-20 10:54:30
import os
import argparse
from pyspark.sql import *
from pyspark.sql.functions import *
from pyspark.sql.window import Window
from pyspark.sql.types import *
from datetime import datetime
from Datalake.utils.genericUtilities import *
from Datalake.utils.configs import *
from Datalake.utils.mergeUtils import *
from Datalake.utils.logger import *
# COMMAND ----------

parser = argparse.ArgumentParser()
spark = SparkSession.getActiveSession()
parser.add_argument('env', type=str, help='Env Variable')
# args = parser.parse_args()
# env = args.env
env = 'dev'

if env is None or env == '':
    raise ValueError('env is not set')

refine = getEnvPrefix(env) + 'refine'
raw = getEnvPrefix(env) + 'raw'
legacy = getEnvPrefix(env) + 'legacy'

# Set global variables
starttime = datetime.now() #start timestamp of the script


# COMMAND ----------
# Processing node SQ_Shortcut_to_SDS_ACCOUNT, type SOURCE 
# COLUMN COUNT: 5

SQ_Shortcut_to_SDS_ACCOUNT = spark.sql(f"""SELECT
SDS_ACCOUNT.SDS_ACCOUNT_ID,
SDS_ACCOUNT.SDS_SYSTEM_MODIFIED_TSTMP,
SDS_ACCOUNT.SDS_LAST_MODIFIED_TSTMP,
SDS_ACCOUNT.SDS_CREATED_TSTMP,
SDS_ACCOUNT.LOAD_TSTMP
FROM {refine}.SDS_ACCOUNT""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node SQ_Shortcut_to_SDS_ACCOUNT_PRE, type SOURCE 
# COLUMN COUNT: 79

SQ_Shortcut_to_SDS_ACCOUNT_PRE = spark.sql(f"""SELECT
SDS_ACCOUNT_PRE.ID,
SDS_ACCOUNT_PRE.IS_DELETED,
SDS_ACCOUNT_PRE.MASTER_RECORD_ID,
SDS_ACCOUNT_PRE.NAME,
SDS_ACCOUNT_PRE.TYPE,
SDS_ACCOUNT_PRE.PARENT_ID,
SDS_ACCOUNT_PRE.BILLING_STREET,
SDS_ACCOUNT_PRE.BILLING_CITY,
SDS_ACCOUNT_PRE.BILLING_STATE,
SDS_ACCOUNT_PRE.BILLING_POSTAL_CODE,
SDS_ACCOUNT_PRE.BILLING_COUNTRY,
SDS_ACCOUNT_PRE.BILLING_LATITUDE,
SDS_ACCOUNT_PRE.BILLING_LONGITUDE,
SDS_ACCOUNT_PRE.BILLING_GEOCODE_ACCURACY,
SDS_ACCOUNT_PRE.SHIPPING_STREET,
SDS_ACCOUNT_PRE.SHIPPING_CITY,
SDS_ACCOUNT_PRE.SHIPPING_STATE,
SDS_ACCOUNT_PRE.SHIPPING_POSTAL_CODE,
SDS_ACCOUNT_PRE.SHIPPING_COUNTRY,
SDS_ACCOUNT_PRE.SHIPPING_LATITUDE,
SDS_ACCOUNT_PRE.SHIPPING_LONGITUDE,
SDS_ACCOUNT_PRE.SHIPPING_GEOCODE_ACCURACY,
SDS_ACCOUNT_PRE.PHONE,
SDS_ACCOUNT_PRE.FAX,
SDS_ACCOUNT_PRE.ACCOUNT_NUMBER,
SDS_ACCOUNT_PRE.WEBSITE,
SDS_ACCOUNT_PRE.PHOTO_URL,
SDS_ACCOUNT_PRE.SIC,
SDS_ACCOUNT_PRE.INDUSTRY,
SDS_ACCOUNT_PRE.ANNUAL_REVENUE,
SDS_ACCOUNT_PRE.NUMBER_OF_EMPLOYEES,
SDS_ACCOUNT_PRE.OWNERSHIP,
SDS_ACCOUNT_PRE.TICKER_SYMBOL,
SDS_ACCOUNT_PRE.DESCRIPTION,
SDS_ACCOUNT_PRE.RATING,
SDS_ACCOUNT_PRE.SITE,
SDS_ACCOUNT_PRE.CURRENCY_ISO_CODE,
SDS_ACCOUNT_PRE.OWNER_ID,
SDS_ACCOUNT_PRE.CREATED_DATE,
SDS_ACCOUNT_PRE.CREATED_BY_ID,
SDS_ACCOUNT_PRE.LAST_MODIFIED_DATE,
SDS_ACCOUNT_PRE.LAST_MODIFIED_BY_ID,
SDS_ACCOUNT_PRE.SYSTEM_MOD_STAMP,
SDS_ACCOUNT_PRE.LAST_ACTIVITY_DATE,
SDS_ACCOUNT_PRE.LAST_VIEWED_DATE,
SDS_ACCOUNT_PRE.LAST_REFERENCED_DATE,
SDS_ACCOUNT_PRE.JIGSAW,
SDS_ACCOUNT_PRE.JIGSAW_COMPANY_ID,
SDS_ACCOUNT_PRE.ACCOUNT_SOURCE,
SDS_ACCOUNT_PRE.SIC_DESC,
SDS_ACCOUNT_PRE.OPERATING_HOURS_ID,
SDS_ACCOUNT_PRE.PSVC_ACTIVE_C,
SDS_ACCOUNT_PRE.PSVC_AGENT_NAME_C,
SDS_ACCOUNT_PRE.PSVC_BOOKING_ALERT_C,
SDS_ACCOUNT_PRE.PSVC_CHECK_IN_ALERT_C,
SDS_ACCOUNT_PRE.PSVC_CHECK_OUT_ALERT_C,
SDS_ACCOUNT_PRE.PSVC_CUSTOMER_NOTES_C,
SDS_ACCOUNT_PRE.PSVC_DO_NOT_BOOK_REASON_C,
SDS_ACCOUNT_PRE.PSVC_DO_NOT_BOOK_C,
SDS_ACCOUNT_PRE.PSVC_MOBILE_C,
SDS_ACCOUNT_PRE.PSVC_PODS_CUSTOMER_ID_C,
SDS_ACCOUNT_PRE.PSVC_PRIMARY_FLAG_C,
SDS_ACCOUNT_PRE.PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C,
SDS_ACCOUNT_PRE.PSVC_RECEIVE_TEXT_NOTIFICATION_C,
SDS_ACCOUNT_PRE.PSVC_REMINDER_CALL_C,
SDS_ACCOUNT_PRE.PSVC_SMS_CUSTOMER_ID_C,
SDS_ACCOUNT_PRE.PSVC_WORK_PHONE_C,
SDS_ACCOUNT_PRE.PSVC_EMAIL_C,
SDS_ACCOUNT_PRE.PSVC_FIRST_NAME_C,
SDS_ACCOUNT_PRE.PSVC_LAST_NAME_C,
SDS_ACCOUNT_PRE.PSVC_PUSH_C,
SDS_ACCOUNT_PRE.PSVC_RECEIVE_PUSH_NOTIFICATIONS_C,
SDS_ACCOUNT_PRE.PSVC_NEW_GROOMING_CUSTOMER_C,
SDS_ACCOUNT_PRE.PSVC_IS_DIGITAL_LOYALTY_C,
SDS_ACCOUNT_PRE.PRIMARY_PHONE_C,
SDS_ACCOUNT_PRE.PSVC_PSA_ON_FILE_C,
SDS_ACCOUNT_PRE.PSVC_FTC_ELIGIBLE_DATETIME_C,
SDS_ACCOUNT_PRE.PSVC_LAST_APPOINTMENT_DATETIME_C,
SDS_ACCOUNT_PRE.PSVC_IS_FIRST_TIME_CUSTOMER_C
FROM {raw}.SDS_ACCOUNT_PRE""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node JNR_SDS_ACCOUNT, type JOINER . Note: using additional SELECT to rename incoming columns
# COLUMN COUNT: 84

# for each involved DataFrame, append the dataframe name to each column
SQ_Shortcut_to_SDS_ACCOUNT_PRE_temp = SQ_Shortcut_to_SDS_ACCOUNT_PRE.toDF(*["SQ_Shortcut_to_SDS_ACCOUNT_PRE___" + col for col in SQ_Shortcut_to_SDS_ACCOUNT_PRE.columns])
SQ_Shortcut_to_SDS_ACCOUNT_temp = SQ_Shortcut_to_SDS_ACCOUNT.toDF(*["SQ_Shortcut_to_SDS_ACCOUNT___" + col for col in SQ_Shortcut_to_SDS_ACCOUNT.columns])

JNR_SDS_ACCOUNT = SQ_Shortcut_to_SDS_ACCOUNT_temp_PRE_temp.join(SQ_Shortcut_to_SDS_ACCOUNT_temp,[SQ_Shortcut_to_SDS_ACCOUNT_PRE_temp.SQ_Shortcut_to_SDS_ACCOUNT_PRE___ID == SQ_Shortcut_to_SDS_ACCOUNT_temp.SQ_Shortcut_to_SDS_ACCOUNT___SDS_ACCOUNT_ID],'left_outer').selectExpr(
	"SQ_Shortcut_to_SDS_ACCOUNT___SDS_ACCOUNT_ID as i_SDS_ACCOUNT_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT___SDS_SYSTEM_MODIFIED_TSTMP as i_SDS_SYSTEM_MODIFIED_TSTMP",
	"SQ_Shortcut_to_SDS_ACCOUNT___SDS_LAST_MODIFIED_TSTMP as i_SDS_LAST_MODIFIED_TSTMP",
	"SQ_Shortcut_to_SDS_ACCOUNT___SDS_CREATED_TSTMP as i_SDS_CREATED_TSTMP",
	"SQ_Shortcut_to_SDS_ACCOUNT___LOAD_TSTMP as i_LOAD_TSTMP",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___ID as ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___IS_DELETED as IS_DELETED",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___MASTER_RECORD_ID as MASTER_RECORD_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___NAME as NAME",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___TYPE as TYPE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PARENT_ID as PARENT_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_STREET as BILLING_STREET",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_CITY as BILLING_CITY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_STATE as BILLING_STATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_POSTAL_CODE as BILLING_POSTAL_CODE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_COUNTRY as BILLING_COUNTRY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_LATITUDE as BILLING_LATITUDE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_LONGITUDE as BILLING_LONGITUDE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___BILLING_GEOCODE_ACCURACY as BILLING_GEOCODE_ACCURACY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_STREET as SHIPPING_STREET",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_CITY as SHIPPING_CITY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_STATE as SHIPPING_STATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_POSTAL_CODE as SHIPPING_POSTAL_CODE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_COUNTRY as SHIPPING_COUNTRY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_LATITUDE as SHIPPING_LATITUDE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_LONGITUDE as SHIPPING_LONGITUDE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SHIPPING_GEOCODE_ACCURACY as SHIPPING_GEOCODE_ACCURACY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PHONE as PHONE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___FAX as FAX",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___ACCOUNT_NUMBER as ACCOUNT_NUMBER",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___WEBSITE as WEBSITE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PHOTO_URL as PHOTO_URL",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SIC as SIC",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___INDUSTRY as INDUSTRY",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___ANNUAL_REVENUE as ANNUAL_REVENUE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___NUMBER_OF_EMPLOYEES as NUMBER_OF_EMPLOYEES",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___OWNERSHIP as OWNERSHIP",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___TICKER_SYMBOL as TICKER_SYMBOL",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___DESCRIPTION as DESCRIPTION",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___RATING as RATING",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SITE as SITE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___CURRENCY_ISO_CODE as CURRENCY_ISO_CODE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___OWNER_ID as OWNER_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___CREATED_DATE as CREATED_DATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___CREATED_BY_ID as CREATED_BY_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___LAST_MODIFIED_DATE as LAST_MODIFIED_DATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___LAST_MODIFIED_BY_ID as LAST_MODIFIED_BY_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SYSTEM_MOD_STAMP as SYSTEM_MOD_STAMP",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___LAST_ACTIVITY_DATE as LAST_ACTIVITY_DATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___LAST_VIEWED_DATE as LAST_VIEWED_DATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___LAST_REFERENCED_DATE as LAST_REFERENCED_DATE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___JIGSAW as JIGSAW",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___JIGSAW_COMPANY_ID as JIGSAW_COMPANY_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___ACCOUNT_SOURCE as ACCOUNT_SOURCE",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___SIC_DESC as SIC_DESC",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___OPERATING_HOURS_ID as OPERATING_HOURS_ID",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_ACTIVE_C as PSVC_ACTIVE_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_AGENT_NAME_C as PSVC_AGENT_NAME_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_BOOKING_ALERT_C as PSVC_BOOKING_ALERT_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_CHECK_IN_ALERT_C as PSVC_CHECK_IN_ALERT_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_CHECK_OUT_ALERT_C as PSVC_CHECK_OUT_ALERT_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_CUSTOMER_NOTES_C as PSVC_CUSTOMER_NOTES_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_DO_NOT_BOOK_REASON_C as PSVC_DO_NOT_BOOK_REASON_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_DO_NOT_BOOK_C as PSVC_DO_NOT_BOOK_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_MOBILE_C as PSVC_MOBILE_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_PODS_CUSTOMER_ID_C as PSVC_PODS_CUSTOMER_ID_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_PRIMARY_FLAG_C as PSVC_PRIMARY_FLAG_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C as PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_RECEIVE_TEXT_NOTIFICATION_C as PSVC_RECEIVE_TEXT_NOTIFICATION_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_REMINDER_CALL_C as PSVC_REMINDER_CALL_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_SMS_CUSTOMER_ID_C as PSVC_SMS_CUSTOMER_ID_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_WORK_PHONE_C as PSVC_WORK_PHONE_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_EMAIL_C as PSVC_EMAIL_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_FIRST_NAME_C as PSVC_FIRST_NAME_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_LAST_NAME_C as PSVC_LAST_NAME_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_PUSH_C as PSVC_PUSH_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_RECEIVE_PUSH_NOTIFICATIONS_C as PSVC_RECEIVE_PUSH_NOTIFICATIONS_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_NEW_GROOMING_CUSTOMER_C as PSVC_NEW_GROOMING_CUSTOMER_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_IS_DIGITAL_LOYALTY_C as PSVC_IS_DIGITAL_LOYALTY_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PRIMARY_PHONE_C as PRIMARY_PHONE_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_PSA_ON_FILE_C as PSVC_PSA_ON_FILE_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_FTC_ELIGIBLE_DATETIME_C as PSVC_FTC_ELIGIBLE_DATETIME_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_LAST_APPOINTMENT_DATETIME_C as PSVC_LAST_APPOINTMENT_DATETIME_C",
	"SQ_Shortcut_to_SDS_ACCOUNT_PRE___PSVC_IS_FIRST_TIME_CUSTOMER_C as PSVC_IS_FIRST_TIME_CUSTOMER_C")

# COMMAND ----------
# Processing node FIL_SDS_ACCOUNT, type FILTER 
# COLUMN COUNT: 84

# for each involved DataFrame, append the dataframe name to each column
JNR_SDS_ACCOUNT_temp = JNR_SDS_ACCOUNT.toDF(*["JNR_SDS_ACCOUNT___" + col for col in JNR_SDS_ACCOUNT.columns])

FIL_SDS_ACCOUNT = JNR_SDS_ACCOUNT_temp.selectExpr(
	"JNR_SDS_ACCOUNT___i_SDS_ACCOUNT_ID as i_SDS_ACCOUNT_ID",
	"JNR_SDS_ACCOUNT___i_SDS_SYSTEM_MODIFIED_TSTMP as i_SDS_SYSTEM_MODIFIED_TSTMP",
	"JNR_SDS_ACCOUNT___i_SDS_LAST_MODIFIED_TSTMP as i_SDS_LAST_MODIFIED_TSTMP",
	"JNR_SDS_ACCOUNT___i_SDS_CREATED_TSTMP as i_SDS_CREATED_TSTMP",
	"JNR_SDS_ACCOUNT___i_LOAD_TSTMP as i_LOAD_TSTMP",
	"JNR_SDS_ACCOUNT___ID as ID",
	"JNR_SDS_ACCOUNT___IS_DELETED as IS_DELETED",
	"JNR_SDS_ACCOUNT___MASTER_RECORD_ID as MASTER_RECORD_ID",
	"JNR_SDS_ACCOUNT___NAME as NAME",
	"JNR_SDS_ACCOUNT___TYPE as TYPE",
	"JNR_SDS_ACCOUNT___PARENT_ID as PARENT_ID",
	"JNR_SDS_ACCOUNT___BILLING_STREET as BILLING_STREET",
	"JNR_SDS_ACCOUNT___BILLING_CITY as BILLING_CITY",
	"JNR_SDS_ACCOUNT___BILLING_STATE as BILLING_STATE",
	"JNR_SDS_ACCOUNT___BILLING_POSTAL_CODE as BILLING_POSTAL_CODE",
	"JNR_SDS_ACCOUNT___BILLING_COUNTRY as BILLING_COUNTRY",
	"JNR_SDS_ACCOUNT___BILLING_LATITUDE as BILLING_LATITUDE",
	"JNR_SDS_ACCOUNT___BILLING_LONGITUDE as BILLING_LONGITUDE",
	"JNR_SDS_ACCOUNT___BILLING_GEOCODE_ACCURACY as BILLING_GEOCODE_ACCURACY",
	"JNR_SDS_ACCOUNT___SHIPPING_STREET as SHIPPING_STREET",
	"JNR_SDS_ACCOUNT___SHIPPING_CITY as SHIPPING_CITY",
	"JNR_SDS_ACCOUNT___SHIPPING_STATE as SHIPPING_STATE",
	"JNR_SDS_ACCOUNT___SHIPPING_POSTAL_CODE as SHIPPING_POSTAL_CODE",
	"JNR_SDS_ACCOUNT___SHIPPING_COUNTRY as SHIPPING_COUNTRY",
	"JNR_SDS_ACCOUNT___SHIPPING_LATITUDE as SHIPPING_LATITUDE",
	"JNR_SDS_ACCOUNT___SHIPPING_LONGITUDE as SHIPPING_LONGITUDE",
	"JNR_SDS_ACCOUNT___SHIPPING_GEOCODE_ACCURACY as SHIPPING_GEOCODE_ACCURACY",
	"JNR_SDS_ACCOUNT___PHONE as PHONE",
	"JNR_SDS_ACCOUNT___FAX as FAX",
	"JNR_SDS_ACCOUNT___ACCOUNT_NUMBER as ACCOUNT_NUMBER",
	"JNR_SDS_ACCOUNT___WEBSITE as WEBSITE",
	"JNR_SDS_ACCOUNT___PHOTO_URL as PHOTO_URL",
	"JNR_SDS_ACCOUNT___SIC as SIC",
	"JNR_SDS_ACCOUNT___INDUSTRY as INDUSTRY",
	"JNR_SDS_ACCOUNT___ANNUAL_REVENUE as ANNUAL_REVENUE",
	"JNR_SDS_ACCOUNT___NUMBER_OF_EMPLOYEES as NUMBER_OF_EMPLOYEES",
	"JNR_SDS_ACCOUNT___OWNERSHIP as OWNERSHIP",
	"JNR_SDS_ACCOUNT___TICKER_SYMBOL as TICKER_SYMBOL",
	"JNR_SDS_ACCOUNT___DESCRIPTION as DESCRIPTION",
	"JNR_SDS_ACCOUNT___RATING as RATING",
	"JNR_SDS_ACCOUNT___SITE as SITE",
	"JNR_SDS_ACCOUNT___CURRENCY_ISO_CODE as CURRENCY_ISO_CODE",
	"JNR_SDS_ACCOUNT___OWNER_ID as OWNER_ID",
	"JNR_SDS_ACCOUNT___CREATED_DATE as CREATED_DATE",
	"JNR_SDS_ACCOUNT___CREATED_BY_ID as CREATED_BY_ID",
	"JNR_SDS_ACCOUNT___LAST_MODIFIED_DATE as LAST_MODIFIED_DATE",
	"JNR_SDS_ACCOUNT___LAST_MODIFIED_BY_ID as LAST_MODIFIED_BY_ID",
	"JNR_SDS_ACCOUNT___SYSTEM_MOD_STAMP as SYSTEM_MOD_STAMP",
	"JNR_SDS_ACCOUNT___LAST_ACTIVITY_DATE as LAST_ACTIVITY_DATE",
	"JNR_SDS_ACCOUNT___LAST_VIEWED_DATE as LAST_VIEWED_DATE",
	"JNR_SDS_ACCOUNT___LAST_REFERENCED_DATE as LAST_REFERENCED_DATE",
	"JNR_SDS_ACCOUNT___JIGSAW as JIGSAW",
	"JNR_SDS_ACCOUNT___JIGSAW_COMPANY_ID as JIGSAW_COMPANY_ID",
	"JNR_SDS_ACCOUNT___ACCOUNT_SOURCE as ACCOUNT_SOURCE",
	"JNR_SDS_ACCOUNT___SIC_DESC as SIC_DESC",
	"JNR_SDS_ACCOUNT___OPERATING_HOURS_ID as OPERATING_HOURS_ID",
	"JNR_SDS_ACCOUNT___PSVC_ACTIVE_C as PSVC_ACTIVE_C",
	"JNR_SDS_ACCOUNT___PSVC_AGENT_NAME_C as PSVC_AGENT_NAME_C",
	"JNR_SDS_ACCOUNT___PSVC_BOOKING_ALERT_C as PSVC_BOOKING_ALERT_C",
	"JNR_SDS_ACCOUNT___PSVC_CHECK_IN_ALERT_C as PSVC_CHECK_IN_ALERT_C",
	"JNR_SDS_ACCOUNT___PSVC_CHECK_OUT_ALERT_C as PSVC_CHECK_OUT_ALERT_C",
	"JNR_SDS_ACCOUNT___PSVC_CUSTOMER_NOTES_C as PSVC_CUSTOMER_NOTES_C",
	"JNR_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_REASON_C as PSVC_DO_NOT_BOOK_REASON_C",
	"JNR_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_C as PSVC_DO_NOT_BOOK_C",
	"JNR_SDS_ACCOUNT___PSVC_MOBILE_C as PSVC_MOBILE_C",
	"JNR_SDS_ACCOUNT___PSVC_PODS_CUSTOMER_ID_C as PSVC_PODS_CUSTOMER_ID_C",
	"JNR_SDS_ACCOUNT___PSVC_PRIMARY_FLAG_C as PSVC_PRIMARY_FLAG_C",
	"JNR_SDS_ACCOUNT___PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C as PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C",
	"JNR_SDS_ACCOUNT___PSVC_RECEIVE_TEXT_NOTIFICATION_C as PSVC_RECEIVE_TEXT_NOTIFICATION_C",
	"JNR_SDS_ACCOUNT___PSVC_REMINDER_CALL_C as PSVC_REMINDER_CALL_C",
	"JNR_SDS_ACCOUNT___PSVC_SMS_CUSTOMER_ID_C as PSVC_SMS_CUSTOMER_ID_C",
	"JNR_SDS_ACCOUNT___PSVC_WORK_PHONE_C as PSVC_WORK_PHONE_C",
	"JNR_SDS_ACCOUNT___PSVC_EMAIL_C as PSVC_EMAIL_C",
	"JNR_SDS_ACCOUNT___PSVC_FIRST_NAME_C as PSVC_FIRST_NAME_C",
	"JNR_SDS_ACCOUNT___PSVC_LAST_NAME_C as PSVC_LAST_NAME_C",
	"JNR_SDS_ACCOUNT___PSVC_PUSH_C as PSVC_PUSH_C",
	"JNR_SDS_ACCOUNT___PSVC_RECEIVE_PUSH_NOTIFICATIONS_C as PSVC_RECEIVE_PUSH_NOTIFICATIONS_C",
	"JNR_SDS_ACCOUNT___PSVC_NEW_GROOMING_CUSTOMER_C as PSVC_NEW_GROOMING_CUSTOMER_C",
	"JNR_SDS_ACCOUNT___PSVC_IS_DIGITAL_LOYALTY_C as PSVC_IS_DIGITAL_LOYALTY_C",
	"JNR_SDS_ACCOUNT___PRIMARY_PHONE_C as PRIMARY_PHONE_C",
	"JNR_SDS_ACCOUNT___PSVC_PSA_ON_FILE_C as PSVC_PSA_ON_FILE_C",
	"JNR_SDS_ACCOUNT___PSVC_FTC_ELIGIBLE_DATETIME_C as PSVC_FTC_ELIGIBLE_DATETIME_C",
	"JNR_SDS_ACCOUNT___PSVC_LAST_APPOINTMENT_DATETIME_C as PSVC_LAST_APPOINTMENT_DATETIME_C",
	"JNR_SDS_ACCOUNT___PSVC_IS_FIRST_TIME_CUSTOMER_C as PSVC_IS_FIRST_TIME_CUSTOMER_C").filter("i_SDS_ACCOUNT_ID IS NULL OR ( i_SDS_ACCOUNT_ID IS NOT NULL AND ( i_SDS_SYSTEM_MODIFIED_TSTMP != SYSTEM_MOD_STAMP OR i_SDS_CREATED_TSTMP != CREATED_DATE OR i_SDS_LAST_MODIFIED_TSTMP != LAST_MODIFIED_DATE ) )").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node EXP_SDS_ACCOUNT, type EXPRESSION 
# COLUMN COUNT: 82

# for each involved DataFrame, append the dataframe name to each column
FIL_SDS_ACCOUNT_temp = FIL_SDS_ACCOUNT.toDF(*["FIL_SDS_ACCOUNT___" + col for col in FIL_SDS_ACCOUNT.columns])

EXP_SDS_ACCOUNT = FIL_SDS_ACCOUNT_temp.selectExpr(
	"FIL_SDS_ACCOUNT___sys_row_id as sys_row_id",
	"FIL_SDS_ACCOUNT___ID as ID",
	"FIL_SDS_ACCOUNT___IS_DELETED as IS_DELETED",
	"FIL_SDS_ACCOUNT___MASTER_RECORD_ID as MASTER_RECORD_ID",
	"FIL_SDS_ACCOUNT___NAME as NAME",
	"FIL_SDS_ACCOUNT___TYPE as TYPE",
	"FIL_SDS_ACCOUNT___PARENT_ID as PARENT_ID",
	"FIL_SDS_ACCOUNT___BILLING_STREET as BILLING_STREET",
	"FIL_SDS_ACCOUNT___BILLING_CITY as BILLING_CITY",
	"FIL_SDS_ACCOUNT___BILLING_STATE as BILLING_STATE",
	"FIL_SDS_ACCOUNT___BILLING_POSTAL_CODE as BILLING_POSTAL_CODE",
	"FIL_SDS_ACCOUNT___BILLING_COUNTRY as BILLING_COUNTRY",
	"FIL_SDS_ACCOUNT___BILLING_LATITUDE as BILLING_LATITUDE",
	"FIL_SDS_ACCOUNT___BILLING_LONGITUDE as BILLING_LONGITUDE",
	"FIL_SDS_ACCOUNT___BILLING_GEOCODE_ACCURACY as BILLING_GEOCODE_ACCURACY",
	"FIL_SDS_ACCOUNT___SHIPPING_STREET as SHIPPING_STREET",
	"FIL_SDS_ACCOUNT___SHIPPING_CITY as SHIPPING_CITY",
	"FIL_SDS_ACCOUNT___SHIPPING_STATE as SHIPPING_STATE",
	"FIL_SDS_ACCOUNT___SHIPPING_POSTAL_CODE as SHIPPING_POSTAL_CODE",
	"FIL_SDS_ACCOUNT___SHIPPING_COUNTRY as SHIPPING_COUNTRY",
	"FIL_SDS_ACCOUNT___SHIPPING_LATITUDE as SHIPPING_LATITUDE",
	"FIL_SDS_ACCOUNT___SHIPPING_LONGITUDE as SHIPPING_LONGITUDE",
	"FIL_SDS_ACCOUNT___SHIPPING_GEOCODE_ACCURACY as SHIPPING_GEOCODE_ACCURACY",
	"FIL_SDS_ACCOUNT___PHONE as PHONE",
	"FIL_SDS_ACCOUNT___FAX as FAX",
	"FIL_SDS_ACCOUNT___ACCOUNT_NUMBER as ACCOUNT_NUMBER",
	"FIL_SDS_ACCOUNT___WEBSITE as WEBSITE",
	"FIL_SDS_ACCOUNT___PHOTO_URL as PHOTO_URL",
	"FIL_SDS_ACCOUNT___SIC as SIC",
	"FIL_SDS_ACCOUNT___INDUSTRY as INDUSTRY",
	"FIL_SDS_ACCOUNT___ANNUAL_REVENUE as ANNUAL_REVENUE",
	"FIL_SDS_ACCOUNT___NUMBER_OF_EMPLOYEES as NUMBER_OF_EMPLOYEES",
	"FIL_SDS_ACCOUNT___OWNERSHIP as OWNERSHIP",
	"FIL_SDS_ACCOUNT___TICKER_SYMBOL as TICKER_SYMBOL",
	"FIL_SDS_ACCOUNT___DESCRIPTION as DESCRIPTION",
	"FIL_SDS_ACCOUNT___RATING as RATING",
	"FIL_SDS_ACCOUNT___SITE as SITE",
	"FIL_SDS_ACCOUNT___CURRENCY_ISO_CODE as CURRENCY_ISO_CODE",
	"FIL_SDS_ACCOUNT___OWNER_ID as OWNER_ID",
	"FIL_SDS_ACCOUNT___CREATED_DATE as CREATED_DATE",
	"FIL_SDS_ACCOUNT___CREATED_BY_ID as CREATED_BY_ID",
	"FIL_SDS_ACCOUNT___LAST_MODIFIED_DATE as LAST_MODIFIED_DATE",
	"FIL_SDS_ACCOUNT___LAST_MODIFIED_BY_ID as LAST_MODIFIED_BY_ID",
	"FIL_SDS_ACCOUNT___SYSTEM_MOD_STAMP as SYSTEM_MOD_STAMP",
	"FIL_SDS_ACCOUNT___LAST_ACTIVITY_DATE as LAST_ACTIVITY_DATE",
	"FIL_SDS_ACCOUNT___LAST_VIEWED_DATE as LAST_VIEWED_DATE",
	"FIL_SDS_ACCOUNT___LAST_REFERENCED_DATE as LAST_REFERENCED_DATE",
	"FIL_SDS_ACCOUNT___JIGSAW as JIGSAW",
	"FIL_SDS_ACCOUNT___JIGSAW_COMPANY_ID as JIGSAW_COMPANY_ID",
	"FIL_SDS_ACCOUNT___ACCOUNT_SOURCE as ACCOUNT_SOURCE",
	"FIL_SDS_ACCOUNT___SIC_DESC as SIC_DESC",
	"FIL_SDS_ACCOUNT___OPERATING_HOURS_ID as OPERATING_HOURS_ID",
	"FIL_SDS_ACCOUNT___PSVC_ACTIVE_C as PSVC_ACTIVE_C",
	"FIL_SDS_ACCOUNT___PSVC_AGENT_NAME_C as PSVC_AGENT_NAME_C",
	"FIL_SDS_ACCOUNT___PSVC_BOOKING_ALERT_C as PSVC_BOOKING_ALERT_C",
	"FIL_SDS_ACCOUNT___PSVC_CHECK_IN_ALERT_C as PSVC_CHECK_IN_ALERT_C",
	"FIL_SDS_ACCOUNT___PSVC_CHECK_OUT_ALERT_C as PSVC_CHECK_OUT_ALERT_C",
	"FIL_SDS_ACCOUNT___PSVC_CUSTOMER_NOTES_C as PSVC_CUSTOMER_NOTES_C",
	"FIL_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_REASON_C as PSVC_DO_NOT_BOOK_REASON_C",
	"FIL_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_C as PSVC_DO_NOT_BOOK_C",
	"FIL_SDS_ACCOUNT___PSVC_MOBILE_C as PSVC_MOBILE_C",
	"FIL_SDS_ACCOUNT___PSVC_PODS_CUSTOMER_ID_C as PSVC_PODS_CUSTOMER_ID_C",
	"FIL_SDS_ACCOUNT___PSVC_PRIMARY_FLAG_C as PSVC_PRIMARY_FLAG_C",
	"FIL_SDS_ACCOUNT___PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C as PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C",
	"FIL_SDS_ACCOUNT___PSVC_RECEIVE_TEXT_NOTIFICATION_C as PSVC_RECEIVE_TEXT_NOTIFICATION_C",
	"FIL_SDS_ACCOUNT___PSVC_REMINDER_CALL_C as PSVC_REMINDER_CALL_C",
	"FIL_SDS_ACCOUNT___PSVC_SMS_CUSTOMER_ID_C as PSVC_SMS_CUSTOMER_ID_C",
	"FIL_SDS_ACCOUNT___PSVC_WORK_PHONE_C as PSVC_WORK_PHONE_C",
	"FIL_SDS_ACCOUNT___PSVC_EMAIL_C as PSVC_EMAIL_C",
	"FIL_SDS_ACCOUNT___PSVC_FIRST_NAME_C as PSVC_FIRST_NAME_C",
	"FIL_SDS_ACCOUNT___PSVC_LAST_NAME_C as PSVC_LAST_NAME_C",
	"FIL_SDS_ACCOUNT___PSVC_PUSH_C as PSVC_PUSH_C",
	"FIL_SDS_ACCOUNT___PSVC_RECEIVE_PUSH_NOTIFICATIONS_C as PSVC_RECEIVE_PUSH_NOTIFICATIONS_C",
	"FIL_SDS_ACCOUNT___PSVC_NEW_GROOMING_CUSTOMER_C as PSVC_NEW_GROOMING_CUSTOMER_C",
	"FIL_SDS_ACCOUNT___PSVC_IS_DIGITAL_LOYALTY_C as PSVC_IS_DIGITAL_LOYALTY_C",
	"FIL_SDS_ACCOUNT___PRIMARY_PHONE_C as PRIMARY_PHONE_C",
	"FIL_SDS_ACCOUNT___PSVC_PSA_ON_FILE_C as PSVC_PSA_ON_FILE_C",
	"FIL_SDS_ACCOUNT___PSVC_FTC_ELIGIBLE_DATETIME_C as PSVC_FTC_ELIGIBLE_DATETIME_C",
	"FIL_SDS_ACCOUNT___PSVC_LAST_APPOINTMENT_DATETIME_C as PSVC_LAST_APPOINTMENT_DATETIME_C",
	"FIL_SDS_ACCOUNT___PSVC_IS_FIRST_TIME_CUSTOMER_C as PSVC_IS_FIRST_TIME_CUSTOMER_C",
	"CURRENT_TIMESTAMP as UPDATE_TSTMP",
	"IF (FIL_SDS_ACCOUNT___i_LOAD_TSTMP IS NULL, CURRENT_TIMESTAMP, FIL_SDS_ACCOUNT___i_LOAD_TSTMP) as LOAD_TSTMP",
	"IF (FIL_SDS_ACCOUNT___i_SDS_ACCOUNT_ID IS NULL, 1, 2) as o_UPDATE_VALIDATOR"
)

# COMMAND ----------
# Processing node UPD_SDS_ACCOUNT, type UPDATE_STRATEGY 
# COLUMN COUNT: 82

# for each involved DataFrame, append the dataframe name to each column
EXP_SDS_ACCOUNT_temp = EXP_SDS_ACCOUNT.toDF(*["EXP_SDS_ACCOUNT___" + col for col in EXP_SDS_ACCOUNT.columns])

UPD_SDS_ACCOUNT = EXP_SDS_ACCOUNT_temp.selectExpr(
	"EXP_SDS_ACCOUNT___ID as ID",
	"EXP_SDS_ACCOUNT___IS_DELETED as IS_DELETED",
	"EXP_SDS_ACCOUNT___MASTER_RECORD_ID as MASTER_RECORD_ID",
	"EXP_SDS_ACCOUNT___NAME as NAME",
	"EXP_SDS_ACCOUNT___TYPE as TYPE",
	"EXP_SDS_ACCOUNT___PARENT_ID as PARENT_ID",
	"EXP_SDS_ACCOUNT___BILLING_STREET as BILLING_STREET",
	"EXP_SDS_ACCOUNT___BILLING_CITY as BILLING_CITY",
	"EXP_SDS_ACCOUNT___BILLING_STATE as BILLING_STATE",
	"EXP_SDS_ACCOUNT___BILLING_POSTAL_CODE as BILLING_POSTAL_CODE",
	"EXP_SDS_ACCOUNT___BILLING_COUNTRY as BILLING_COUNTRY",
	"EXP_SDS_ACCOUNT___BILLING_LATITUDE as BILLING_LATITUDE",
	"EXP_SDS_ACCOUNT___BILLING_LONGITUDE as BILLING_LONGITUDE",
	"EXP_SDS_ACCOUNT___BILLING_GEOCODE_ACCURACY as BILLING_GEOCODE_ACCURACY",
	"EXP_SDS_ACCOUNT___SHIPPING_STREET as SHIPPING_STREET",
	"EXP_SDS_ACCOUNT___SHIPPING_CITY as SHIPPING_CITY",
	"EXP_SDS_ACCOUNT___SHIPPING_STATE as SHIPPING_STATE",
	"EXP_SDS_ACCOUNT___SHIPPING_POSTAL_CODE as SHIPPING_POSTAL_CODE",
	"EXP_SDS_ACCOUNT___SHIPPING_COUNTRY as SHIPPING_COUNTRY",
	"EXP_SDS_ACCOUNT___SHIPPING_LATITUDE as SHIPPING_LATITUDE",
	"EXP_SDS_ACCOUNT___SHIPPING_LONGITUDE as SHIPPING_LONGITUDE",
	"EXP_SDS_ACCOUNT___SHIPPING_GEOCODE_ACCURACY as SHIPPING_GEOCODE_ACCURACY",
	"EXP_SDS_ACCOUNT___PHONE as PHONE",
	"EXP_SDS_ACCOUNT___FAX as FAX",
	"EXP_SDS_ACCOUNT___ACCOUNT_NUMBER as ACCOUNT_NUMBER",
	"EXP_SDS_ACCOUNT___WEBSITE as WEBSITE",
	"EXP_SDS_ACCOUNT___PHOTO_URL as PHOTO_URL",
	"EXP_SDS_ACCOUNT___SIC as SIC",
	"EXP_SDS_ACCOUNT___INDUSTRY as INDUSTRY",
	"EXP_SDS_ACCOUNT___ANNUAL_REVENUE as ANNUAL_REVENUE",
	"EXP_SDS_ACCOUNT___NUMBER_OF_EMPLOYEES as NUMBER_OF_EMPLOYEES",
	"EXP_SDS_ACCOUNT___OWNERSHIP as OWNERSHIP",
	"EXP_SDS_ACCOUNT___TICKER_SYMBOL as TICKER_SYMBOL",
	"EXP_SDS_ACCOUNT___DESCRIPTION as DESCRIPTION",
	"EXP_SDS_ACCOUNT___RATING as RATING",
	"EXP_SDS_ACCOUNT___SITE as SITE",
	"EXP_SDS_ACCOUNT___CURRENCY_ISO_CODE as CURRENCY_ISO_CODE",
	"EXP_SDS_ACCOUNT___OWNER_ID as OWNER_ID",
	"EXP_SDS_ACCOUNT___CREATED_DATE as CREATED_DATE",
	"EXP_SDS_ACCOUNT___CREATED_BY_ID as CREATED_BY_ID",
	"EXP_SDS_ACCOUNT___LAST_MODIFIED_DATE as LAST_MODIFIED_DATE",
	"EXP_SDS_ACCOUNT___LAST_MODIFIED_BY_ID as LAST_MODIFIED_BY_ID",
	"EXP_SDS_ACCOUNT___SYSTEM_MOD_STAMP as SYSTEM_MOD_STAMP",
	"EXP_SDS_ACCOUNT___LAST_ACTIVITY_DATE as LAST_ACTIVITY_DATE",
	"EXP_SDS_ACCOUNT___LAST_VIEWED_DATE as LAST_VIEWED_DATE",
	"EXP_SDS_ACCOUNT___LAST_REFERENCED_DATE as LAST_REFERENCED_DATE",
	"EXP_SDS_ACCOUNT___JIGSAW as JIGSAW",
	"EXP_SDS_ACCOUNT___JIGSAW_COMPANY_ID as JIGSAW_COMPANY_ID",
	"EXP_SDS_ACCOUNT___ACCOUNT_SOURCE as ACCOUNT_SOURCE",
	"EXP_SDS_ACCOUNT___SIC_DESC as SIC_DESC",
	"EXP_SDS_ACCOUNT___OPERATING_HOURS_ID as OPERATING_HOURS_ID",
	"EXP_SDS_ACCOUNT___PSVC_ACTIVE_C as PSVC_ACTIVE_C",
	"EXP_SDS_ACCOUNT___PSVC_AGENT_NAME_C as PSVC_AGENT_NAME_C",
	"EXP_SDS_ACCOUNT___PSVC_BOOKING_ALERT_C as PSVC_BOOKING_ALERT_C",
	"EXP_SDS_ACCOUNT___PSVC_CHECK_IN_ALERT_C as PSVC_CHECK_IN_ALERT_C",
	"EXP_SDS_ACCOUNT___PSVC_CHECK_OUT_ALERT_C as PSVC_CHECK_OUT_ALERT_C",
	"EXP_SDS_ACCOUNT___PSVC_CUSTOMER_NOTES_C as PSVC_CUSTOMER_NOTES_C",
	"EXP_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_REASON_C as PSVC_DO_NOT_BOOK_REASON_C",
	"EXP_SDS_ACCOUNT___PSVC_DO_NOT_BOOK_C as PSVC_DO_NOT_BOOK_C",
	"EXP_SDS_ACCOUNT___PSVC_MOBILE_C as PSVC_MOBILE_C",
	"EXP_SDS_ACCOUNT___PSVC_PODS_CUSTOMER_ID_C as PSVC_PODS_CUSTOMER_ID_C",
	"EXP_SDS_ACCOUNT___PSVC_PRIMARY_FLAG_C as PSVC_PRIMARY_FLAG_C",
	"EXP_SDS_ACCOUNT___PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C as PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C",
	"EXP_SDS_ACCOUNT___PSVC_RECEIVE_TEXT_NOTIFICATION_C as PSVC_RECEIVE_TEXT_NOTIFICATION_C",
	"EXP_SDS_ACCOUNT___PSVC_REMINDER_CALL_C as PSVC_REMINDER_CALL_C",
	"EXP_SDS_ACCOUNT___PSVC_SMS_CUSTOMER_ID_C as PSVC_SMS_CUSTOMER_ID_C",
	"EXP_SDS_ACCOUNT___PSVC_WORK_PHONE_C as PSVC_WORK_PHONE_C",
	"EXP_SDS_ACCOUNT___PSVC_EMAIL_C as PSVC_EMAIL_C",
	"EXP_SDS_ACCOUNT___PSVC_FIRST_NAME_C as PSVC_FIRST_NAME_C",
	"EXP_SDS_ACCOUNT___PSVC_LAST_NAME_C as PSVC_LAST_NAME_C",
	"EXP_SDS_ACCOUNT___PSVC_PUSH_C as PSVC_PUSH_C",
	"EXP_SDS_ACCOUNT___PSVC_RECEIVE_PUSH_NOTIFICATIONS_C as PSVC_RECEIVE_PUSH_NOTIFICATIONS_C",
	"EXP_SDS_ACCOUNT___PSVC_NEW_GROOMING_CUSTOMER_C as PSVC_NEW_GROOMING_CUSTOMER_C",
	"EXP_SDS_ACCOUNT___PSVC_IS_DIGITAL_LOYALTY_C as PSVC_IS_DIGITAL_LOYALTY_C",
	"EXP_SDS_ACCOUNT___PRIMARY_PHONE_C as PRIMARY_PHONE_C",
	"EXP_SDS_ACCOUNT___PSVC_PSA_ON_FILE_C as PSVC_PSA_ON_FILE_C",
	"EXP_SDS_ACCOUNT___PSVC_FTC_ELIGIBLE_DATETIME_C as PSVC_FTC_ELIGIBLE_DATETIME_C",
	"EXP_SDS_ACCOUNT___PSVC_LAST_APPOINTMENT_DATETIME_C as PSVC_LAST_APPOINTMENT_DATETIME_C",
	"EXP_SDS_ACCOUNT___PSVC_IS_FIRST_TIME_CUSTOMER_C as PSVC_IS_FIRST_TIME_CUSTOMER_C",
	"EXP_SDS_ACCOUNT___UPDATE_TSTMP as UPDATE_TSTMP",
	"EXP_SDS_ACCOUNT___LOAD_TSTMP as LOAD_TSTMP",
	"EXP_SDS_ACCOUNT___o_UPDATE_VALIDATOR as o_UPDATE_VALIDATOR")\
	.withColumn('pyspark_data_action', when(col('o_UPDATE_VALIDATOR') ==(lit(1)) , lit(0)) .when(col('o_UPDATE_VALIDATOR') ==(lit(2)) , lit(1)))

# COMMAND ----------
# Processing node Shortcut_to_SDS_ACCOUNT_1, type TARGET 
# COLUMN COUNT: 81


Shortcut_to_SDS_ACCOUNT_1 = UPD_SDS_ACCOUNT.selectExpr(
	"CAST(ID AS STRING) as SDS_ACCOUNT_ID",
	"CAST(ACCOUNT_NUMBER AS STRING) as SDS_ACCOUNT_NBR",
	"CAST(NAME AS STRING) as SDS_ACCOUNT_NAME",
	"CAST(DESCRIPTION AS STRING) as SDS_ACCOUNT_DESC",
	"CAST(TYPE AS STRING) as SDS_ACCOUNT_TYPE",
	"CAST(ACCOUNT_SOURCE AS STRING) as SDS_ACCOUNT_SOURCE",
	"CAST(MASTER_RECORD_ID AS STRING) as SDS_MASTER_RECORD_ID",
	"CAST(PARENT_ID AS STRING) as SDS_PARENT_ID",
	"CAST(PSVC_FIRST_NAME_C AS STRING) as FIRST_NAME",
	"CAST(PSVC_LAST_NAME_C AS STRING) as LAST_NAME",
	"CAST(PHONE AS STRING) as PHONE",
	"CAST(PSVC_MOBILE_C AS STRING) as MOBILE_PHONE",
	"CAST(PSVC_WORK_PHONE_C AS STRING) as WORK_PHONE",
	"CAST(PRIMARY_PHONE_C AS STRING) as PRIMARY_PHONE_TYPE",
	"CAST(FAX AS STRING) as FAX",
	"CAST(PSVC_EMAIL_C AS STRING) as EMAIL",
	"CAST(PSVC_PUSH_C AS STRING) as PUSH_DEVICE_ID",
	"CAST(PSVC_AGENT_NAME_C AS STRING) as AGENT_NAME",
	"CAST(BILLING_STREET AS STRING) as BILLING_STREET",
	"CAST(BILLING_CITY AS STRING) as BILLING_CITY",
	"CAST(BILLING_STATE AS STRING) as BILLING_STATE",
	"CAST(BILLING_POSTAL_CODE AS STRING) as BILLING_POSTAL_CD",
	"CAST(BILLING_COUNTRY AS STRING) as BILLING_COUNTRY",
	"CAST(BILLING_LATITUDE AS DECIMAL(18,15)) as BILLING_LATITUDE",
	"CAST(BILLING_LONGITUDE AS DECIMAL(18,15)) as BILLING_LONGITUDE",
	"CAST(BILLING_GEOCODE_ACCURACY AS STRING) as BILLING_GEOCODE_ACCURACY",
	"CAST(SHIPPING_STREET AS STRING) as SHIPPING_STREET",
	"CAST(SHIPPING_CITY AS STRING) as SHIPPING_CITY",
	"CAST(SHIPPING_STATE AS STRING) as SHIPPING_STATE",
	"CAST(SHIPPING_POSTAL_CODE AS STRING) as SHIPPING_POSTAL_CD",
	"CAST(SHIPPING_COUNTRY AS STRING) as SHIPPING_COUNTRY",
	"CAST(SHIPPING_LATITUDE AS DECIMAL(18,15)) as SHIPPING_LATITUDE",
	"CAST(SHIPPING_LONGITUDE AS DECIMAL(18,15)) as SHIPPING_LONGITUDE",
	"CAST(SHIPPING_GEOCODE_ACCURACY AS STRING) as SHIPPING_GEOCODE_ACCURACY",
	"CAST(WEBSITE AS STRING) as WEBSITE",
	"CAST(PHOTO_URL AS STRING) as PHOTO_URL",
	"CAST(INDUSTRY AS STRING) as INDUSTRY",
	"CAST(ANNUAL_REVENUE AS BIGINT) as ANNUAL_REVENUE",
	"CAST(NUMBER_OF_EMPLOYEES AS BIGINT) as NUMBER_OF_EMPLOYEES",
	"CAST(OWNERSHIP AS STRING) as OWNERSHIP",
	"CAST(TICKER_SYMBOL AS STRING) as TICKER_SYMBOL",
	"CAST(JIGSAW AS STRING) as JIGSAW",
	"CAST(JIGSAW_COMPANY_ID AS STRING) as SDS_JIGSAW_COMPANY_ID",
	"CAST(SIC AS STRING) as SIC",
	"CAST(SIC_DESC AS STRING) as SIC_DESC",
	"CAST(RATING AS STRING) as RATING",
	"CAST(SITE AS STRING) as SITE",
	"CAST(OPERATING_HOURS_ID AS STRING) as SDS_OPERATING_HOURS_ID",
	"CAST(PSVC_BOOKING_ALERT_C AS STRING) as BOOKING_ALERT",
	"CAST(PSVC_CHECK_IN_ALERT_C AS STRING) as CHECK_IN_ALERT",
	"CAST(PSVC_CHECK_OUT_ALERT_C AS STRING) as CHECK_OUT_ALERT",
	"CAST(PSVC_CUSTOMER_NOTES_C AS STRING) as CUSTOMER_NOTES",
	"CAST(PSVC_DO_NOT_BOOK_C AS TINYINT) as DO_NOT_BOOK_FLAG",
	"CAST(PSVC_DO_NOT_BOOK_REASON_C AS STRING) as DO_NOT_BOOK_REASON",
	"CAST(PSVC_RECEIVE_EMAIL_NOTIFICATIONS_C AS TINYINT) as RECEIVE_EMAIL_NOTIFICATIONS_FLAG",
	"CAST(PSVC_RECEIVE_TEXT_NOTIFICATION_C AS TINYINT) as RECEIVE_TEXT_NOTIFICATION_FLAG",
	"CAST(PSVC_RECEIVE_PUSH_NOTIFICATIONS_C AS TINYINT) as RECEIVE_PUSH_NOTIFICATION_FLAG",
	"CAST(PSVC_REMINDER_CALL_C AS TINYINT) as REMINDER_CALL_FLAG",
	"CAST(PSVC_NEW_GROOMING_CUSTOMER_C AS TINYINT) as GROOMING_NEW_FLAG",
	"CAST(PSVC_PRIMARY_FLAG_C AS TINYINT) as PRIMARY_FLAG",
	"CAST(PSVC_IS_DIGITAL_LOYALTY_C AS TINYINT) as DIGITAL_LOYALTY_CUSTOMER_FLAG",
	"CAST(PSVC_PSA_ON_FILE_C AS TINYINT) as PSA_ON_FILE_FLAG",
	"CAST(PSVC_IS_FIRST_TIME_CUSTOMER_C AS TINYINT) as FIRST_TIME_CUSTOMER_FLAG",
	"CAST(PSVC_FTC_ELIGIBLE_DATETIME_C AS TIMESTAMP) as FTC_ELIGIBLE_TSTMP",
	"CAST(PSVC_LAST_APPOINTMENT_DATETIME_C AS TIMESTAMP) as LAST_APPOINTMENT_TSTMP",
	"CAST(PSVC_PODS_CUSTOMER_ID_C AS STRING) as PODS_CUSTOMER_ID",
	"CAST(PSVC_SMS_CUSTOMER_ID_C AS BIGINT) as SMS_CUSTOMER_ID",
	"CAST(OWNER_ID AS STRING) as SDS_OWNER_ID",
	"CAST(CURRENCY_ISO_CODE AS STRING) as CURRENCY_ISO_CD",
	"CAST(PSVC_ACTIVE_C AS TINYINT) as ACTIVE_FLAG",
	"CAST(IS_DELETED AS TINYINT) as DELETED_FLAG",
	"CAST(LAST_ACTIVITY_DATE AS TIMESTAMP) as SDS_LAST_ACTIVITY_TSTMP",
	"CAST(LAST_VIEWED_DATE AS TIMESTAMP) as SDS_LAST_VIEWED_TSTMP",
	"CAST(LAST_REFERENCED_DATE AS TIMESTAMP) as SDS_LAST_REFERENCED_TSTMP",
	"CAST(SYSTEM_MOD_STAMP AS TIMESTAMP) as SDS_SYSTEM_MODIFIED_TSTMP",
	"CAST(LAST_MODIFIED_DATE AS TIMESTAMP) as SDS_LAST_MODIFIED_TSTMP",
	"CAST(LAST_MODIFIED_BY_ID AS STRING) as SDS_LAST_MODIFIED_BY_ID",
	"CAST(CREATED_DATE AS TIMESTAMP) as SDS_CREATED_TSTMP",
	"CAST(CREATED_BY_ID AS STRING) as SDS_CREATED_BY_ID",
	"CAST(UPDATE_TSTMP AS TIMESTAMP) as UPDATE_TSTMP",
	"CAST(LOAD_TSTMP AS TIMESTAMP) as LOAD_TSTMP",
	"UPD_SDS_ACCOUNT.pyspark_data_action as pyspark_data_action"
)

try:
  primary_key = """source.SDS_ACCOUNT_ID = target.SDS_ACCOUNT_ID"""
  refined_perf_table = f"{refine}.SDS_ACCOUNT"
  executeMerge(Shortcut_to_SDS_ACCOUNT_1, refined_perf_table, primary_key)
  logger.info(f"Merge with {refined_perf_table} completed]")
  logPrevRunDt("SDS_ACCOUNT", "SDS_ACCOUNT", "Completed", "N/A", f"{raw}.log_run_details")
except Exception as e:
  logPrevRunDt("SDS_ACCOUNT", "SDS_ACCOUNT","Failed",str(e), f"{raw}.log_run_details", )
  raise e
	