#Code converted on 2023-06-26 17:05:16
import os
import argparse
from pyspark.sql import *
from pyspark.sql.functions import *
from pyspark.sql.window import Window
from pyspark.sql.types import *
from datetime import datetime
from pyspark.dbutils import DBUtils
from Datalake.utils.genericUtilities import *
from Datalake.utils.configs import *
from Datalake.utils.mergeUtils import *
from Datalake.utils.logger import *
# COMMAND ----------

parser = argparse.ArgumentParser()
spark = SparkSession.getActiveSession()
dbutils = DBUtils(spark)
parser.add_argument('env', type=str, help='Env Variable')
args = parser.parse_args()
env = args.env
# env = 'dev'

if env is None or env == '':
    raise ValueError('env is not set')

refine = getEnvPrefix(env) + 'refine'
raw = getEnvPrefix(env) + 'raw'
legacy = getEnvPrefix(env) + 'legacy'

# Set global variables
starttime = datetime.now() #start timestamp of the script
refined_perf_table = f"{refine}.WM_OUTPT_ORDER_LINE_ITEM"
raw_perf_table = f"{raw}.WM_OUTPT_ORDER_LINE_ITEM_PRE"
site_profile_table = f"{legacy}.SITE_PROFILE"

# COMMAND ----------
# Processing node SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM, type SOURCE 
# COLUMN COUNT: 5

SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM = spark.sql(f"""SELECT
LOCATION_ID,
WM_OUTPT_ORDER_LINE_ITEM_ID,
WM_CREATED_TSTMP,
WM_LAST_UPDATED_TSTMP,
LOAD_TSTMP
FROM {refined_perf_table}
WHERE WM_OUTPT_ORDER_LINE_ITEM_ID IN (SELECT OUTPT_ORDER_LINE_ITEM_ID FROM {raw_perf_table})""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE, type SOURCE 
# COLUMN COUNT: 100

SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE = spark.sql(f"""SELECT
DC_NBR,
OUTPT_ORDER_LINE_ITEM_ID,
ACTUAL_COST_CURRENCY_CODE,
ACTUAL_SHIPPED_DTTM,
ASSORT_NBR,
BACK_ORD_QTY,
BATCH_CTRL_NBR,
BATCH_NBR,
CNTRY_OF_ORGN,
COMMODITY_CLASS,
CREATED_DTTM,
CREATED_SOURCE,
CREATED_SOURCE_TYPE,
CUSTOMER_ITEM,
EXP_INFO_CODE,
GTIN,
INVC_BATCH_NBR,
INVN_TYPE,
ITEM_ATTR_1,
ITEM_ATTR_2,
ITEM_ATTR_3,
ITEM_ATTR_4,
ITEM_ATTR_5,
ITEM_ID,
LAST_UPDATED_DTTM,
LAST_UPDATED_SOURCE,
LAST_UPDATED_SOURCE_TYPE,
LINE_ITEM_ID,
LINE_TYPE,
MANUFACTURING_DTTM,
MISC_INSTR_10_BYTE_1,
MISC_INSTR_10_BYTE_2,
ORDER_QTY,
ORDER_QTY_UOM,
ORIG_ITEM_ID,
ORIG_ORDER_LINE_ITEM_ID,
ORIG_ORDER_QTY,
ORIG_ORDER_QTY_UOM,
PARENT_LINE_ITEM_ID,
PICKUP_END_DTTM,
PICKUP_REFERENCE_NUMBER,
PICKUP_START_DTTM,
PLANNED_QUANTITY,
PLANNED_QUANTITY_UOM,
PLANNED_SHIP_DATE,
PPACK_GRP_CODE,
PPACK_QTY,
PRICE,
PRICE_TKT_TYPE,
PROC_DTTM,
PROC_STAT_CODE,
PRODUCT_STATUS,
PURCHASE_ORDER_LINE_NUMBER,
REASON_CODE,
REC_PROC_FLAG,
REC_XPANS_FIELD,
RETAIL_PRICE,
SHIPPED_QTY,
TC_COMPANY_ID,
UNIT_VOL,
UNIT_WT,
UOM,
USER_CANCELED_QTY,
VERSION_NBR,
AISLE,
AREA,
BAY,
LVL,
POSN,
ZONE,
ITEM_COLOR,
ITEM_COLOR_SFX,
ITEM_SEASON,
ITEM_SEASON_YEAR,
ITEM_SECOND_DIM,
ITEM_SIZE_DESC,
ITEM_QUALITY,
ITEM_STYLE,
ITEM_STYLE_SFX,
SIZE_RANGE_CODE,
SIZE_REL_POSN_IN_TABLE,
SHELF_DAYS,
TEMP_ZONE,
ORIG_ITEM_COLOR,
ORIG_ITEM_COLOR_SFX,
ORIG_ITEM_SEASON,
ORIG_ITEM_SEASON_YEAR,
ORIG_ITEM_SECOND_DIM,
ORIG_ITEM_SIZE_DESC,
ORIG_ITEM_QUALITY,
ORIG_ITEM_STYLE,
ORIG_ITEM_STYLE_SFX,
TC_ORDER_ID,
TC_PURCHASE_ORDERS_ID,
ITEM_NAME,
ACTUAL_COST,
TC_ORDER_LINE_ID,
PURCHASE_ORDER_NUMBER,
EXT_PURCHASE_ORDER,
LOAD_TSTMP
FROM {raw_perf_table}""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node SQ_Shortcut_to_SITE_PROFILE, type SOURCE 
# COLUMN COUNT: 2

SQ_Shortcut_to_SITE_PROFILE = spark.sql(f"""SELECT LOCATION_ID, STORE_NBR FROM {site_profile_table}""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node EXP_TRANS, type EXPRESSION 
# COLUMN COUNT: 101

# for each involved DataFrame, append the dataframe name to each column
SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE_temp = SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE.toDF(*["SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___" + col for col in SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE.columns])

EXP_TRANS = SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE_temp.selectExpr( \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___sys_row_id as sys_row_id", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___DC_NBR as DC_NBR", \
	"cast(SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___DC_NBR as int) as o_DC_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___OUTPT_ORDER_LINE_ITEM_ID as OUTPT_ORDER_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ACTUAL_COST_CURRENCY_CODE as ACTUAL_COST_CURRENCY_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ACTUAL_SHIPPED_DTTM as ACTUAL_SHIPPED_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ASSORT_NBR as ASSORT_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___BACK_ORD_QTY as BACK_ORD_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___BATCH_CTRL_NBR as BATCH_CTRL_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___BATCH_NBR as BATCH_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___COMMODITY_CLASS as COMMODITY_CLASS", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___CREATED_DTTM as CREATED_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___CREATED_SOURCE as CREATED_SOURCE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___CUSTOMER_ITEM as CUSTOMER_ITEM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___EXP_INFO_CODE as EXP_INFO_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___GTIN as GTIN", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___INVC_BATCH_NBR as INVC_BATCH_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___INVN_TYPE as INVN_TYPE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ATTR_1 as ITEM_ATTR_1", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ATTR_2 as ITEM_ATTR_2", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ATTR_3 as ITEM_ATTR_3", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ATTR_4 as ITEM_ATTR_4", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ATTR_5 as ITEM_ATTR_5", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_ID as ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LINE_ITEM_ID as LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LINE_TYPE as LINE_TYPE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___MANUFACTURING_DTTM as MANUFACTURING_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___MISC_INSTR_10_BYTE_1 as MISC_INSTR_10_BYTE_1", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___MISC_INSTR_10_BYTE_2 as MISC_INSTR_10_BYTE_2", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORDER_QTY as ORDER_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORDER_QTY_UOM as ORDER_QTY_UOM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_ID as ORIG_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ORDER_LINE_ITEM_ID as ORIG_ORDER_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ORDER_QTY as ORIG_ORDER_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ORDER_QTY_UOM as ORIG_ORDER_QTY_UOM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PARENT_LINE_ITEM_ID as PARENT_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PICKUP_END_DTTM as PICKUP_END_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PICKUP_REFERENCE_NUMBER as PICKUP_REFERENCE_NUMBER", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PICKUP_START_DTTM as PICKUP_START_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PLANNED_QUANTITY as PLANNED_QUANTITY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PLANNED_QUANTITY_UOM as PLANNED_QUANTITY_UOM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PLANNED_SHIP_DATE as PLANNED_SHIP_DATE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PPACK_QTY as PPACK_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PRICE as PRICE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PRICE_TKT_TYPE as PRICE_TKT_TYPE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PROC_DTTM as PROC_DTTM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PROC_STAT_CODE as PROC_STAT_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PRODUCT_STATUS as PRODUCT_STATUS", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PURCHASE_ORDER_LINE_NUMBER as PURCHASE_ORDER_LINE_NUMBER", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___REASON_CODE as REASON_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___REC_PROC_FLAG as REC_PROC_FLAG", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___REC_XPANS_FIELD as REC_XPANS_FIELD", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___RETAIL_PRICE as RETAIL_PRICE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___SHIPPED_QTY as SHIPPED_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___TC_COMPANY_ID as TC_COMPANY_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___UNIT_VOL as UNIT_VOL", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___UNIT_WT as UNIT_WT", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___UOM as UOM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___USER_CANCELED_QTY as USER_CANCELED_QTY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___VERSION_NBR as VERSION_NBR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___AISLE as AISLE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___AREA as AREA", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___BAY as BAY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LVL as LVL", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___POSN as POSN", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ZONE as ZONE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_COLOR as ITEM_COLOR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_COLOR_SFX as ITEM_COLOR_SFX", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_SEASON as ITEM_SEASON", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_SEASON_YEAR as ITEM_SEASON_YEAR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_SECOND_DIM as ITEM_SECOND_DIM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_SIZE_DESC as ITEM_SIZE_DESC", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_QUALITY as ITEM_QUALITY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_STYLE as ITEM_STYLE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_STYLE_SFX as ITEM_STYLE_SFX", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___SIZE_RANGE_CODE as SIZE_RANGE_CODE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___SIZE_REL_POSN_IN_TABLE as SIZE_REL_POSN_IN_TABLE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___SHELF_DAYS as SHELF_DAYS", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___TEMP_ZONE as TEMP_ZONE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_COLOR as ORIG_ITEM_COLOR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_COLOR_SFX as ORIG_ITEM_COLOR_SFX", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_SEASON as ORIG_ITEM_SEASON", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_SEASON_YEAR as ORIG_ITEM_SEASON_YEAR", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_SECOND_DIM as ORIG_ITEM_SECOND_DIM", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_SIZE_DESC as ORIG_ITEM_SIZE_DESC", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_QUALITY as ORIG_ITEM_QUALITY", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_STYLE as ORIG_ITEM_STYLE", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ORIG_ITEM_STYLE_SFX as ORIG_ITEM_STYLE_SFX", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___TC_ORDER_ID as TC_ORDER_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ITEM_NAME as ITEM_NAME", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___ACTUAL_COST as ACTUAL_COST", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___PURCHASE_ORDER_NUMBER as PURCHASE_ORDER_NUMBER", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___EXT_PURCHASE_ORDER as EXT_PURCHASE_ORDER", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_PRE___LOAD_TSTMP as LOAD_TSTMP" \
)

# COMMAND ----------
# Processing node JNR_SITE_PROFILE, type JOINER 
# COLUMN COUNT: 101

JNR_SITE_PROFILE = SQ_Shortcut_to_SITE_PROFILE.join(EXP_TRANS,[SQ_Shortcut_to_SITE_PROFILE.STORE_NBR == EXP_TRANS.o_DC_NBR],'inner')

# COMMAND ----------
# Processing node JNR_WM_OUTPT_ORDER_LINE_ITEM, type JOINER . Note: using additional SELECT to rename incoming columns
# COLUMN COUNT: 104

# for each involved DataFrame, append the dataframe name to each column
JNR_SITE_PROFILE_temp = JNR_SITE_PROFILE.toDF(*["JNR_SITE_PROFILE___" + col for col in JNR_SITE_PROFILE.columns])
SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_temp = SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM.toDF(*["SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___" + col for col in SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM.columns])

JNR_WM_OUTPT_ORDER_LINE_ITEM = SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_temp.join(JNR_SITE_PROFILE_temp,[SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_temp.SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___LOCATION_ID == JNR_SITE_PROFILE_temp.JNR_SITE_PROFILE___LOCATION_ID, SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM_temp.SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___WM_OUTPT_ORDER_LINE_ITEM_ID == JNR_SITE_PROFILE_temp.JNR_SITE_PROFILE___OUTPT_ORDER_LINE_ITEM_ID],'right_outer').selectExpr( \
	"JNR_SITE_PROFILE___LOCATION_ID as LOCATION_ID", \
	"JNR_SITE_PROFILE___OUTPT_ORDER_LINE_ITEM_ID as OUTPT_ORDER_LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___ACTUAL_COST_CURRENCY_CODE as ACTUAL_COST_CURRENCY_CODE", \
	"JNR_SITE_PROFILE___ACTUAL_SHIPPED_DTTM as ACTUAL_SHIPPED_DTTM", \
	"JNR_SITE_PROFILE___ASSORT_NBR as ASSORT_NBR", \
	"JNR_SITE_PROFILE___BACK_ORD_QTY as BACK_ORD_QTY", \
	"JNR_SITE_PROFILE___BATCH_CTRL_NBR as BATCH_CTRL_NBR", \
	"JNR_SITE_PROFILE___BATCH_NBR as BATCH_NBR", \
	"JNR_SITE_PROFILE___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"JNR_SITE_PROFILE___COMMODITY_CLASS as COMMODITY_CLASS", \
	"JNR_SITE_PROFILE___CREATED_DTTM as CREATED_DTTM", \
	"JNR_SITE_PROFILE___CREATED_SOURCE as CREATED_SOURCE", \
	"JNR_SITE_PROFILE___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"JNR_SITE_PROFILE___CUSTOMER_ITEM as CUSTOMER_ITEM", \
	"JNR_SITE_PROFILE___EXP_INFO_CODE as EXP_INFO_CODE", \
	"JNR_SITE_PROFILE___GTIN as GTIN", \
	"JNR_SITE_PROFILE___INVC_BATCH_NBR as INVC_BATCH_NBR", \
	"JNR_SITE_PROFILE___INVN_TYPE as INVN_TYPE", \
	"JNR_SITE_PROFILE___ITEM_ATTR_1 as ITEM_ATTR_1", \
	"JNR_SITE_PROFILE___ITEM_ATTR_2 as ITEM_ATTR_2", \
	"JNR_SITE_PROFILE___ITEM_ATTR_3 as ITEM_ATTR_3", \
	"JNR_SITE_PROFILE___ITEM_ATTR_4 as ITEM_ATTR_4", \
	"JNR_SITE_PROFILE___ITEM_ATTR_5 as ITEM_ATTR_5", \
	"JNR_SITE_PROFILE___ITEM_ID as ITEM_ID", \
	"JNR_SITE_PROFILE___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"JNR_SITE_PROFILE___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"JNR_SITE_PROFILE___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"JNR_SITE_PROFILE___LINE_ITEM_ID as LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___LINE_TYPE as LINE_TYPE", \
	"JNR_SITE_PROFILE___MANUFACTURING_DTTM as MANUFACTURING_DTTM", \
	"JNR_SITE_PROFILE___MISC_INSTR_10_BYTE_1 as MISC_INSTR_10_BYTE_1", \
	"JNR_SITE_PROFILE___MISC_INSTR_10_BYTE_2 as MISC_INSTR_10_BYTE_2", \
	"JNR_SITE_PROFILE___ORDER_QTY as ORDER_QTY", \
	"JNR_SITE_PROFILE___ORDER_QTY_UOM as ORDER_QTY_UOM", \
	"JNR_SITE_PROFILE___ORIG_ITEM_ID as ORIG_ITEM_ID", \
	"JNR_SITE_PROFILE___ORIG_ORDER_LINE_ITEM_ID as ORIG_ORDER_LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___ORIG_ORDER_QTY as ORIG_ORDER_QTY", \
	"JNR_SITE_PROFILE___ORIG_ORDER_QTY_UOM as ORIG_ORDER_QTY_UOM", \
	"JNR_SITE_PROFILE___PARENT_LINE_ITEM_ID as PARENT_LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___PICKUP_END_DTTM as PICKUP_END_DTTM", \
	"JNR_SITE_PROFILE___PICKUP_REFERENCE_NUMBER as PICKUP_REFERENCE_NUMBER", \
	"JNR_SITE_PROFILE___PICKUP_START_DTTM as PICKUP_START_DTTM", \
	"JNR_SITE_PROFILE___PLANNED_QUANTITY as PLANNED_QUANTITY", \
	"JNR_SITE_PROFILE___PLANNED_QUANTITY_UOM as PLANNED_QUANTITY_UOM", \
	"JNR_SITE_PROFILE___PLANNED_SHIP_DATE as PLANNED_SHIP_DATE", \
	"JNR_SITE_PROFILE___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"JNR_SITE_PROFILE___PPACK_QTY as PPACK_QTY", \
	"JNR_SITE_PROFILE___PRICE as PRICE", \
	"JNR_SITE_PROFILE___PRICE_TKT_TYPE as PRICE_TKT_TYPE", \
	"JNR_SITE_PROFILE___PROC_DTTM as PROC_DTTM", \
	"JNR_SITE_PROFILE___PROC_STAT_CODE as PROC_STAT_CODE", \
	"JNR_SITE_PROFILE___PRODUCT_STATUS as PRODUCT_STATUS", \
	"JNR_SITE_PROFILE___PURCHASE_ORDER_LINE_NUMBER as PURCHASE_ORDER_LINE_NUMBER", \
	"JNR_SITE_PROFILE___REASON_CODE as REASON_CODE", \
	"JNR_SITE_PROFILE___REC_PROC_FLAG as REC_PROC_FLAG", \
	"JNR_SITE_PROFILE___REC_XPANS_FIELD as REC_XPANS_FIELD", \
	"JNR_SITE_PROFILE___RETAIL_PRICE as RETAIL_PRICE", \
	"JNR_SITE_PROFILE___SHIPPED_QTY as SHIPPED_QTY", \
	"JNR_SITE_PROFILE___TC_COMPANY_ID as TC_COMPANY_ID", \
	"JNR_SITE_PROFILE___UNIT_VOL as UNIT_VOL", \
	"JNR_SITE_PROFILE___UNIT_WT as UNIT_WT", \
	"JNR_SITE_PROFILE___UOM as UOM", \
	"JNR_SITE_PROFILE___USER_CANCELED_QTY as USER_CANCELED_QTY", \
	"JNR_SITE_PROFILE___VERSION_NBR as VERSION_NBR", \
	"JNR_SITE_PROFILE___AISLE as AISLE", \
	"JNR_SITE_PROFILE___AREA as AREA", \
	"JNR_SITE_PROFILE___BAY as BAY", \
	"JNR_SITE_PROFILE___LVL as LVL", \
	"JNR_SITE_PROFILE___POSN as POSN", \
	"JNR_SITE_PROFILE___ZONE as ZONE", \
	"JNR_SITE_PROFILE___ITEM_COLOR as ITEM_COLOR", \
	"JNR_SITE_PROFILE___ITEM_COLOR_SFX as ITEM_COLOR_SFX", \
	"JNR_SITE_PROFILE___ITEM_SEASON as ITEM_SEASON", \
	"JNR_SITE_PROFILE___ITEM_SEASON_YEAR as ITEM_SEASON_YEAR", \
	"JNR_SITE_PROFILE___ITEM_SECOND_DIM as ITEM_SECOND_DIM", \
	"JNR_SITE_PROFILE___ITEM_SIZE_DESC as ITEM_SIZE_DESC", \
	"JNR_SITE_PROFILE___ITEM_QUALITY as ITEM_QUALITY", \
	"JNR_SITE_PROFILE___ITEM_STYLE as ITEM_STYLE", \
	"JNR_SITE_PROFILE___ITEM_STYLE_SFX as ITEM_STYLE_SFX", \
	"JNR_SITE_PROFILE___SIZE_RANGE_CODE as SIZE_RANGE_CODE", \
	"JNR_SITE_PROFILE___SIZE_REL_POSN_IN_TABLE as SIZE_REL_POSN_IN_TABLE", \
	"JNR_SITE_PROFILE___SHELF_DAYS as SHELF_DAYS", \
	"JNR_SITE_PROFILE___TEMP_ZONE as TEMP_ZONE", \
	"JNR_SITE_PROFILE___ORIG_ITEM_COLOR as ORIG_ITEM_COLOR", \
	"JNR_SITE_PROFILE___ORIG_ITEM_COLOR_SFX as ORIG_ITEM_COLOR_SFX", \
	"JNR_SITE_PROFILE___ORIG_ITEM_SEASON as ORIG_ITEM_SEASON", \
	"JNR_SITE_PROFILE___ORIG_ITEM_SEASON_YEAR as ORIG_ITEM_SEASON_YEAR", \
	"JNR_SITE_PROFILE___ORIG_ITEM_SECOND_DIM as ORIG_ITEM_SECOND_DIM", \
	"JNR_SITE_PROFILE___ORIG_ITEM_SIZE_DESC as ORIG_ITEM_SIZE_DESC", \
	"JNR_SITE_PROFILE___ORIG_ITEM_QUALITY as ORIG_ITEM_QUALITY", \
	"JNR_SITE_PROFILE___ORIG_ITEM_STYLE as ORIG_ITEM_STYLE", \
	"JNR_SITE_PROFILE___ORIG_ITEM_STYLE_SFX as ORIG_ITEM_STYLE_SFX", \
	"JNR_SITE_PROFILE___TC_ORDER_ID as TC_ORDER_ID", \
	"JNR_SITE_PROFILE___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"JNR_SITE_PROFILE___ITEM_NAME as ITEM_NAME", \
	"JNR_SITE_PROFILE___ACTUAL_COST as ACTUAL_COST", \
	"JNR_SITE_PROFILE___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"JNR_SITE_PROFILE___PURCHASE_ORDER_NUMBER as PURCHASE_ORDER_NUMBER", \
	"JNR_SITE_PROFILE___EXT_PURCHASE_ORDER as EXT_PURCHASE_ORDER", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___LOCATION_ID as i_LOCATION_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___WM_OUTPT_ORDER_LINE_ITEM_ID as i_WM_OUTPT_ORDER_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___WM_CREATED_TSTMP as i_WM_CREATED_TSTMP", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___WM_LAST_UPDATED_TSTMP as i_WM_LAST_UPDATED_TSTMP", \
	"SQ_Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM___LOAD_TSTMP as i_LOAD_TSTMP")

# COMMAND ----------
# Processing node FIL_UNCHANGED_RECORDS, type FILTER 
# COLUMN COUNT: 103

# for each involved DataFrame, append the dataframe name to each column
JNR_WM_OUTPT_ORDER_LINE_ITEM_temp = JNR_WM_OUTPT_ORDER_LINE_ITEM.toDF(*["JNR_WM_OUTPT_ORDER_LINE_ITEM___" + col for col in JNR_WM_OUTPT_ORDER_LINE_ITEM.columns])

FIL_UNCHANGED_RECORDS = JNR_WM_OUTPT_ORDER_LINE_ITEM_temp.selectExpr( \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LOCATION_ID as LOCATION_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___OUTPT_ORDER_LINE_ITEM_ID as OUTPT_ORDER_LINE_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ACTUAL_COST_CURRENCY_CODE as ACTUAL_COST_CURRENCY_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ACTUAL_SHIPPED_DTTM as ACTUAL_SHIPPED_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ASSORT_NBR as ASSORT_NBR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___BACK_ORD_QTY as BACK_ORD_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___BATCH_CTRL_NBR as BATCH_CTRL_NBR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___BATCH_NBR as BATCH_NBR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___COMMODITY_CLASS as COMMODITY_CLASS", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___CREATED_DTTM as CREATED_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___CREATED_SOURCE as CREATED_SOURCE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___CUSTOMER_ITEM as CUSTOMER_ITEM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___EXP_INFO_CODE as EXP_INFO_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___GTIN as GTIN", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___INVC_BATCH_NBR as INVC_BATCH_NBR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___INVN_TYPE as INVN_TYPE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ATTR_1 as ITEM_ATTR_1", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ATTR_2 as ITEM_ATTR_2", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ATTR_3 as ITEM_ATTR_3", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ATTR_4 as ITEM_ATTR_4", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ATTR_5 as ITEM_ATTR_5", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_ID as ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LINE_ITEM_ID as LINE_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LINE_TYPE as LINE_TYPE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___MANUFACTURING_DTTM as MANUFACTURING_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___MISC_INSTR_10_BYTE_1 as MISC_INSTR_10_BYTE_1", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___MISC_INSTR_10_BYTE_2 as MISC_INSTR_10_BYTE_2", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORDER_QTY as ORDER_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORDER_QTY_UOM as ORDER_QTY_UOM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_ID as ORIG_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ORDER_LINE_ITEM_ID as ORIG_ORDER_LINE_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ORDER_QTY as ORIG_ORDER_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ORDER_QTY_UOM as ORIG_ORDER_QTY_UOM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PARENT_LINE_ITEM_ID as PARENT_LINE_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PICKUP_END_DTTM as PICKUP_END_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PICKUP_REFERENCE_NUMBER as PICKUP_REFERENCE_NUMBER", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PICKUP_START_DTTM as PICKUP_START_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PLANNED_QUANTITY as PLANNED_QUANTITY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PLANNED_QUANTITY_UOM as PLANNED_QUANTITY_UOM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PLANNED_SHIP_DATE as PLANNED_SHIP_DATE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PPACK_QTY as PPACK_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PRICE as PRICE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PRICE_TKT_TYPE as PRICE_TKT_TYPE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PROC_DTTM as PROC_DTTM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PROC_STAT_CODE as PROC_STAT_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PRODUCT_STATUS as PRODUCT_STATUS", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PURCHASE_ORDER_LINE_NUMBER as PURCHASE_ORDER_LINE_NUMBER", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___REASON_CODE as REASON_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___REC_PROC_FLAG as REC_PROC_FLAG", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___REC_XPANS_FIELD as REC_XPANS_FIELD", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___RETAIL_PRICE as RETAIL_PRICE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___SHIPPED_QTY as SHIPPED_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___TC_COMPANY_ID as TC_COMPANY_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___UNIT_VOL as UNIT_VOL", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___UNIT_WT as UNIT_WT", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___UOM as UOM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___USER_CANCELED_QTY as USER_CANCELED_QTY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___VERSION_NBR as VERSION_NBR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___AISLE as AISLE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___AREA as AREA", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___BAY as BAY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___LVL as LVL", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___POSN as POSN", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ZONE as ZONE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_COLOR as ITEM_COLOR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_COLOR_SFX as ITEM_COLOR_SFX", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_SEASON as ITEM_SEASON", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_SEASON_YEAR as ITEM_SEASON_YEAR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_SECOND_DIM as ITEM_SECOND_DIM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_SIZE_DESC as ITEM_SIZE_DESC", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_QUALITY as ITEM_QUALITY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_STYLE as ITEM_STYLE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_STYLE_SFX as ITEM_STYLE_SFX", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___SIZE_RANGE_CODE as SIZE_RANGE_CODE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___SIZE_REL_POSN_IN_TABLE as SIZE_REL_POSN_IN_TABLE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___SHELF_DAYS as SHELF_DAYS", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___TEMP_ZONE as TEMP_ZONE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_COLOR as ORIG_ITEM_COLOR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_COLOR_SFX as ORIG_ITEM_COLOR_SFX", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_SEASON as ORIG_ITEM_SEASON", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_SEASON_YEAR as ORIG_ITEM_SEASON_YEAR", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_SECOND_DIM as ORIG_ITEM_SECOND_DIM", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_SIZE_DESC as ORIG_ITEM_SIZE_DESC", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_QUALITY as ORIG_ITEM_QUALITY", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_STYLE as ORIG_ITEM_STYLE", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ORIG_ITEM_STYLE_SFX as ORIG_ITEM_STYLE_SFX", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___TC_ORDER_ID as TC_ORDER_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ITEM_NAME as ITEM_NAME", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___ACTUAL_COST as ACTUAL_COST", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___PURCHASE_ORDER_NUMBER as PURCHASE_ORDER_NUMBER", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___EXT_PURCHASE_ORDER as EXT_PURCHASE_ORDER", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___i_WM_OUTPT_ORDER_LINE_ITEM_ID as i_WM_OUTPT_ORDER_LINE_ITEM_ID", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___i_WM_CREATED_TSTMP as i_WM_CREATED_TSTMP", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___i_WM_LAST_UPDATED_TSTMP as i_WM_LAST_UPDATED_TSTMP", \
	"JNR_WM_OUTPT_ORDER_LINE_ITEM___i_LOAD_TSTMP as i_LOAD_TSTMP") \
    .filter("i_WM_OUTPT_ORDER_LINE_ITEM_ID is Null OR (  i_WM_OUTPT_ORDER_LINE_ITEM_ID is NOT Null AND ( COALESCE(CREATED_DTTM, date'1900-01-01') != COALESCE(i_WM_CREATED_TSTMP, date'1900-01-01') \
             OR COALESCE(LAST_UPDATED_DTTM, date'1900-01-01') != COALESCE(i_WM_LAST_UPDATED_TSTMP, date'1900-01-01')))").withColumn("sys_row_id", monotonically_increasing_id())


# COMMAND ----------
# Processing node EXP_UPD_VALIDATOR, type EXPRESSION 
# COLUMN COUNT: 104

# for each involved DataFrame, append the dataframe name to each column
FIL_UNCHANGED_RECORDS_temp = FIL_UNCHANGED_RECORDS.toDF(*["FIL_UNCHANGED_RECORDS___" + col for col in FIL_UNCHANGED_RECORDS.columns])

EXP_UPD_VALIDATOR = FIL_UNCHANGED_RECORDS_temp.selectExpr( \
	"FIL_UNCHANGED_RECORDS___sys_row_id as sys_row_id", \
	"FIL_UNCHANGED_RECORDS___LOCATION_ID as LOCATION_ID", \
	"FIL_UNCHANGED_RECORDS___OUTPT_ORDER_LINE_ITEM_ID as OUTPT_ORDER_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_COST_CURRENCY_CODE as ACTUAL_COST_CURRENCY_CODE", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_SHIPPED_DTTM as ACTUAL_SHIPPED_DTTM", \
	"FIL_UNCHANGED_RECORDS___ASSORT_NBR as ASSORT_NBR", \
	"FIL_UNCHANGED_RECORDS___BACK_ORD_QTY as BACK_ORD_QTY", \
	"FIL_UNCHANGED_RECORDS___BATCH_CTRL_NBR as BATCH_CTRL_NBR", \
	"FIL_UNCHANGED_RECORDS___BATCH_NBR as BATCH_NBR", \
	"FIL_UNCHANGED_RECORDS___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"FIL_UNCHANGED_RECORDS___COMMODITY_CLASS as COMMODITY_CLASS", \
	"FIL_UNCHANGED_RECORDS___CREATED_DTTM as CREATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE as CREATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___CUSTOMER_ITEM as CUSTOMER_ITEM", \
	"FIL_UNCHANGED_RECORDS___EXP_INFO_CODE as EXP_INFO_CODE", \
	"FIL_UNCHANGED_RECORDS___GTIN as GTIN", \
	"FIL_UNCHANGED_RECORDS___INVC_BATCH_NBR as INVC_BATCH_NBR", \
	"FIL_UNCHANGED_RECORDS___INVN_TYPE as INVN_TYPE", \
	"FIL_UNCHANGED_RECORDS___ITEM_ATTR_1 as ITEM_ATTR_1", \
	"FIL_UNCHANGED_RECORDS___ITEM_ATTR_2 as ITEM_ATTR_2", \
	"FIL_UNCHANGED_RECORDS___ITEM_ATTR_3 as ITEM_ATTR_3", \
	"FIL_UNCHANGED_RECORDS___ITEM_ATTR_4 as ITEM_ATTR_4", \
	"FIL_UNCHANGED_RECORDS___ITEM_ATTR_5 as ITEM_ATTR_5", \
	"FIL_UNCHANGED_RECORDS___ITEM_ID as ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___LINE_ITEM_ID as LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___LINE_TYPE as LINE_TYPE", \
	"FIL_UNCHANGED_RECORDS___MANUFACTURING_DTTM as MANUFACTURING_DTTM", \
	"FIL_UNCHANGED_RECORDS___MISC_INSTR_10_BYTE_1 as MISC_INSTR_10_BYTE_1", \
	"FIL_UNCHANGED_RECORDS___MISC_INSTR_10_BYTE_2 as MISC_INSTR_10_BYTE_2", \
	"FIL_UNCHANGED_RECORDS___ORDER_QTY as ORDER_QTY", \
	"FIL_UNCHANGED_RECORDS___ORDER_QTY_UOM as ORDER_QTY_UOM", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_ID as ORIG_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___ORIG_ORDER_LINE_ITEM_ID as ORIG_ORDER_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___ORIG_ORDER_QTY as ORIG_ORDER_QTY", \
	"FIL_UNCHANGED_RECORDS___ORIG_ORDER_QTY_UOM as ORIG_ORDER_QTY_UOM", \
	"FIL_UNCHANGED_RECORDS___PARENT_LINE_ITEM_ID as PARENT_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___PICKUP_END_DTTM as PICKUP_END_DTTM", \
	"FIL_UNCHANGED_RECORDS___PICKUP_REFERENCE_NUMBER as PICKUP_REFERENCE_NUMBER", \
	"FIL_UNCHANGED_RECORDS___PICKUP_START_DTTM as PICKUP_START_DTTM", \
	"FIL_UNCHANGED_RECORDS___PLANNED_QUANTITY as PLANNED_QUANTITY", \
	"FIL_UNCHANGED_RECORDS___PLANNED_QUANTITY_UOM as PLANNED_QUANTITY_UOM", \
	"FIL_UNCHANGED_RECORDS___PLANNED_SHIP_DATE as PLANNED_SHIP_DATE", \
	"FIL_UNCHANGED_RECORDS___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"FIL_UNCHANGED_RECORDS___PPACK_QTY as PPACK_QTY", \
	"FIL_UNCHANGED_RECORDS___PRICE as PRICE", \
	"FIL_UNCHANGED_RECORDS___PRICE_TKT_TYPE as PRICE_TKT_TYPE", \
	"FIL_UNCHANGED_RECORDS___PROC_DTTM as PROC_DTTM", \
	"FIL_UNCHANGED_RECORDS___PROC_STAT_CODE as PROC_STAT_CODE", \
	"FIL_UNCHANGED_RECORDS___PRODUCT_STATUS as PRODUCT_STATUS", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDER_LINE_NUMBER as PURCHASE_ORDER_LINE_NUMBER", \
	"FIL_UNCHANGED_RECORDS___REASON_CODE as REASON_CODE", \
	"CASE WHEN  LTRIM ( RTRIM ( UPPER ( FIL_UNCHANGED_RECORDS___REC_PROC_FLAG ) ) ) in ('Y','1') THEN '1'ELSE '0' END as o_REC_PROC_FLAG", \
	"FIL_UNCHANGED_RECORDS___REC_XPANS_FIELD as REC_XPANS_FIELD", \
	"FIL_UNCHANGED_RECORDS___RETAIL_PRICE as RETAIL_PRICE", \
	"FIL_UNCHANGED_RECORDS___SHIPPED_QTY as SHIPPED_QTY", \
	"FIL_UNCHANGED_RECORDS___TC_COMPANY_ID as TC_COMPANY_ID", \
	"FIL_UNCHANGED_RECORDS___UNIT_VOL as UNIT_VOL", \
	"FIL_UNCHANGED_RECORDS___UNIT_WT as UNIT_WT", \
	"FIL_UNCHANGED_RECORDS___UOM as UOM", \
	"FIL_UNCHANGED_RECORDS___USER_CANCELED_QTY as USER_CANCELED_QTY", \
	"FIL_UNCHANGED_RECORDS___VERSION_NBR as VERSION_NBR", \
	"FIL_UNCHANGED_RECORDS___AISLE as AISLE", \
	"FIL_UNCHANGED_RECORDS___AREA as AREA", \
	"FIL_UNCHANGED_RECORDS___BAY as BAY", \
	"FIL_UNCHANGED_RECORDS___LVL as LVL", \
	"FIL_UNCHANGED_RECORDS___POSN as POSN", \
	"FIL_UNCHANGED_RECORDS___ZONE as ZONE", \
	"FIL_UNCHANGED_RECORDS___ITEM_COLOR as ITEM_COLOR", \
	"FIL_UNCHANGED_RECORDS___ITEM_COLOR_SFX as ITEM_COLOR_SFX", \
	"FIL_UNCHANGED_RECORDS___ITEM_SEASON as ITEM_SEASON", \
	"FIL_UNCHANGED_RECORDS___ITEM_SEASON_YEAR as ITEM_SEASON_YEAR", \
	"FIL_UNCHANGED_RECORDS___ITEM_SECOND_DIM as ITEM_SECOND_DIM", \
	"FIL_UNCHANGED_RECORDS___ITEM_SIZE_DESC as ITEM_SIZE_DESC", \
	"FIL_UNCHANGED_RECORDS___ITEM_QUALITY as ITEM_QUALITY", \
	"FIL_UNCHANGED_RECORDS___ITEM_STYLE as ITEM_STYLE", \
	"FIL_UNCHANGED_RECORDS___ITEM_STYLE_SFX as ITEM_STYLE_SFX", \
	"FIL_UNCHANGED_RECORDS___SIZE_RANGE_CODE as SIZE_RANGE_CODE", \
	"FIL_UNCHANGED_RECORDS___SIZE_REL_POSN_IN_TABLE as SIZE_REL_POSN_IN_TABLE", \
	"FIL_UNCHANGED_RECORDS___SHELF_DAYS as SHELF_DAYS", \
	"FIL_UNCHANGED_RECORDS___TEMP_ZONE as TEMP_ZONE", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_COLOR as ORIG_ITEM_COLOR", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_COLOR_SFX as ORIG_ITEM_COLOR_SFX", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_SEASON as ORIG_ITEM_SEASON", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_SEASON_YEAR as ORIG_ITEM_SEASON_YEAR", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_SECOND_DIM as ORIG_ITEM_SECOND_DIM", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_SIZE_DESC as ORIG_ITEM_SIZE_DESC", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_QUALITY as ORIG_ITEM_QUALITY", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_STYLE as ORIG_ITEM_STYLE", \
	"FIL_UNCHANGED_RECORDS___ORIG_ITEM_STYLE_SFX as ORIG_ITEM_STYLE_SFX", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_ID as TC_ORDER_ID", \
	"FIL_UNCHANGED_RECORDS___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"FIL_UNCHANGED_RECORDS___ITEM_NAME as ITEM_NAME", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_COST as ACTUAL_COST", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDER_NUMBER as PURCHASE_ORDER_NUMBER", \
	"FIL_UNCHANGED_RECORDS___EXT_PURCHASE_ORDER as EXT_PURCHASE_ORDER", \
	"FIL_UNCHANGED_RECORDS___i_WM_OUTPT_ORDER_LINE_ITEM_ID as i_WM_OUTPT_ORDER_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP as i_LOAD_TSTMP", \
	"CURRENT_TIMESTAMP as UPDATE_TSTMP", \
	"IF(FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP IS NULL, CURRENT_TIMESTAMP, FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP) as LOAD_TSTMP", \
	"IF(FIL_UNCHANGED_RECORDS___i_WM_OUTPT_ORDER_LINE_ITEM_ID IS NULL, 1, 2) as o_UPDATE_VALIDATOR" \
)

# COMMAND ----------
# Processing node UPD_INS_UPD, type UPDATE_STRATEGY 
# COLUMN COUNT: 104

# for each involved DataFrame, append the dataframe name to each column
EXP_UPD_VALIDATOR_temp = EXP_UPD_VALIDATOR.toDF(*["EXP_UPD_VALIDATOR___" + col for col in EXP_UPD_VALIDATOR.columns])

UPD_INS_UPD = EXP_UPD_VALIDATOR_temp.selectExpr( \
	"EXP_UPD_VALIDATOR___LOCATION_ID as LOCATION_ID", \
	"EXP_UPD_VALIDATOR___OUTPT_ORDER_LINE_ITEM_ID as OUTPT_ORDER_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___ACTUAL_COST_CURRENCY_CODE as ACTUAL_COST_CURRENCY_CODE", \
	"EXP_UPD_VALIDATOR___ACTUAL_SHIPPED_DTTM as ACTUAL_SHIPPED_DTTM", \
	"EXP_UPD_VALIDATOR___ASSORT_NBR as ASSORT_NBR", \
	"EXP_UPD_VALIDATOR___BACK_ORD_QTY as BACK_ORD_QTY", \
	"EXP_UPD_VALIDATOR___BATCH_CTRL_NBR as BATCH_CTRL_NBR", \
	"EXP_UPD_VALIDATOR___BATCH_NBR as BATCH_NBR", \
	"EXP_UPD_VALIDATOR___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"EXP_UPD_VALIDATOR___COMMODITY_CLASS as COMMODITY_CLASS", \
	"EXP_UPD_VALIDATOR___CREATED_DTTM as CREATED_DTTM", \
	"EXP_UPD_VALIDATOR___CREATED_SOURCE as CREATED_SOURCE", \
	"EXP_UPD_VALIDATOR___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"EXP_UPD_VALIDATOR___CUSTOMER_ITEM as CUSTOMER_ITEM", \
	"EXP_UPD_VALIDATOR___EXP_INFO_CODE as EXP_INFO_CODE", \
	"EXP_UPD_VALIDATOR___GTIN as GTIN", \
	"EXP_UPD_VALIDATOR___INVC_BATCH_NBR as INVC_BATCH_NBR", \
	"EXP_UPD_VALIDATOR___INVN_TYPE as INVN_TYPE", \
	"EXP_UPD_VALIDATOR___ITEM_ATTR_1 as ITEM_ATTR_1", \
	"EXP_UPD_VALIDATOR___ITEM_ATTR_2 as ITEM_ATTR_2", \
	"EXP_UPD_VALIDATOR___ITEM_ATTR_3 as ITEM_ATTR_3", \
	"EXP_UPD_VALIDATOR___ITEM_ATTR_4 as ITEM_ATTR_4", \
	"EXP_UPD_VALIDATOR___ITEM_ATTR_5 as ITEM_ATTR_5", \
	"EXP_UPD_VALIDATOR___ITEM_ID as ITEM_ID", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"EXP_UPD_VALIDATOR___LINE_ITEM_ID as LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___LINE_TYPE as LINE_TYPE", \
	"EXP_UPD_VALIDATOR___MANUFACTURING_DTTM as MANUFACTURING_DTTM", \
	"EXP_UPD_VALIDATOR___MISC_INSTR_10_BYTE_1 as MISC_INSTR_10_BYTE_1", \
	"EXP_UPD_VALIDATOR___MISC_INSTR_10_BYTE_2 as MISC_INSTR_10_BYTE_2", \
	"EXP_UPD_VALIDATOR___ORDER_QTY as ORDER_QTY", \
	"EXP_UPD_VALIDATOR___ORDER_QTY_UOM as ORDER_QTY_UOM", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_ID as ORIG_ITEM_ID", \
	"EXP_UPD_VALIDATOR___ORIG_ORDER_LINE_ITEM_ID as ORIG_ORDER_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___ORIG_ORDER_QTY as ORIG_ORDER_QTY", \
	"EXP_UPD_VALIDATOR___ORIG_ORDER_QTY_UOM as ORIG_ORDER_QTY_UOM", \
	"EXP_UPD_VALIDATOR___PARENT_LINE_ITEM_ID as PARENT_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___PICKUP_END_DTTM as PICKUP_END_DTTM", \
	"EXP_UPD_VALIDATOR___PICKUP_REFERENCE_NUMBER as PICKUP_REFERENCE_NUMBER", \
	"EXP_UPD_VALIDATOR___PICKUP_START_DTTM as PICKUP_START_DTTM", \
	"EXP_UPD_VALIDATOR___PLANNED_QUANTITY as PLANNED_QUANTITY", \
	"EXP_UPD_VALIDATOR___PLANNED_QUANTITY_UOM as PLANNED_QUANTITY_UOM", \
	"EXP_UPD_VALIDATOR___PLANNED_SHIP_DATE as PLANNED_SHIP_DATE", \
	"EXP_UPD_VALIDATOR___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"EXP_UPD_VALIDATOR___PPACK_QTY as PPACK_QTY", \
	"EXP_UPD_VALIDATOR___PRICE as PRICE", \
	"EXP_UPD_VALIDATOR___PRICE_TKT_TYPE as PRICE_TKT_TYPE", \
	"EXP_UPD_VALIDATOR___PROC_DTTM as PROC_DTTM", \
	"EXP_UPD_VALIDATOR___PROC_STAT_CODE as PROC_STAT_CODE", \
	"EXP_UPD_VALIDATOR___PRODUCT_STATUS as PRODUCT_STATUS", \
	"EXP_UPD_VALIDATOR___PURCHASE_ORDER_LINE_NUMBER as PURCHASE_ORDER_LINE_NUMBER", \
	"EXP_UPD_VALIDATOR___REASON_CODE as REASON_CODE", \
	"EXP_UPD_VALIDATOR___o_REC_PROC_FLAG as o_REC_PROC_FLAG", \
	"EXP_UPD_VALIDATOR___REC_XPANS_FIELD as REC_XPANS_FIELD", \
	"EXP_UPD_VALIDATOR___RETAIL_PRICE as RETAIL_PRICE", \
	"EXP_UPD_VALIDATOR___SHIPPED_QTY as SHIPPED_QTY", \
	"EXP_UPD_VALIDATOR___TC_COMPANY_ID as TC_COMPANY_ID", \
	"EXP_UPD_VALIDATOR___UNIT_VOL as UNIT_VOL", \
	"EXP_UPD_VALIDATOR___UNIT_WT as UNIT_WT", \
	"EXP_UPD_VALIDATOR___UOM as UOM", \
	"EXP_UPD_VALIDATOR___USER_CANCELED_QTY as USER_CANCELED_QTY", \
	"EXP_UPD_VALIDATOR___VERSION_NBR as VERSION_NBR", \
	"EXP_UPD_VALIDATOR___AISLE as AISLE", \
	"EXP_UPD_VALIDATOR___AREA as AREA", \
	"EXP_UPD_VALIDATOR___BAY as BAY", \
	"EXP_UPD_VALIDATOR___LVL as LVL", \
	"EXP_UPD_VALIDATOR___POSN as POSN", \
	"EXP_UPD_VALIDATOR___ZONE as ZONE", \
	"EXP_UPD_VALIDATOR___ITEM_COLOR as ITEM_COLOR", \
	"EXP_UPD_VALIDATOR___ITEM_COLOR_SFX as ITEM_COLOR_SFX", \
	"EXP_UPD_VALIDATOR___ITEM_SEASON as ITEM_SEASON", \
	"EXP_UPD_VALIDATOR___ITEM_SEASON_YEAR as ITEM_SEASON_YEAR", \
	"EXP_UPD_VALIDATOR___ITEM_SECOND_DIM as ITEM_SECOND_DIM", \
	"EXP_UPD_VALIDATOR___ITEM_SIZE_DESC as ITEM_SIZE_DESC", \
	"EXP_UPD_VALIDATOR___ITEM_QUALITY as ITEM_QUALITY", \
	"EXP_UPD_VALIDATOR___ITEM_STYLE as ITEM_STYLE", \
	"EXP_UPD_VALIDATOR___ITEM_STYLE_SFX as ITEM_STYLE_SFX", \
	"EXP_UPD_VALIDATOR___SIZE_RANGE_CODE as SIZE_RANGE_CODE", \
	"EXP_UPD_VALIDATOR___SIZE_REL_POSN_IN_TABLE as SIZE_REL_POSN_IN_TABLE", \
	"EXP_UPD_VALIDATOR___SHELF_DAYS as SHELF_DAYS", \
	"EXP_UPD_VALIDATOR___TEMP_ZONE as TEMP_ZONE", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_COLOR as ORIG_ITEM_COLOR", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_COLOR_SFX as ORIG_ITEM_COLOR_SFX", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_SEASON as ORIG_ITEM_SEASON", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_SEASON_YEAR as ORIG_ITEM_SEASON_YEAR", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_SECOND_DIM as ORIG_ITEM_SECOND_DIM", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_SIZE_DESC as ORIG_ITEM_SIZE_DESC", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_QUALITY as ORIG_ITEM_QUALITY", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_STYLE as ORIG_ITEM_STYLE", \
	"EXP_UPD_VALIDATOR___ORIG_ITEM_STYLE_SFX as ORIG_ITEM_STYLE_SFX", \
	"EXP_UPD_VALIDATOR___TC_ORDER_ID as TC_ORDER_ID", \
	"EXP_UPD_VALIDATOR___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"EXP_UPD_VALIDATOR___ITEM_NAME as ITEM_NAME", \
	"EXP_UPD_VALIDATOR___ACTUAL_COST as ACTUAL_COST", \
	"EXP_UPD_VALIDATOR___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"EXP_UPD_VALIDATOR___PURCHASE_ORDER_NUMBER as PURCHASE_ORDER_NUMBER", \
	"EXP_UPD_VALIDATOR___EXT_PURCHASE_ORDER as EXT_PURCHASE_ORDER", \
	"EXP_UPD_VALIDATOR___i_WM_OUTPT_ORDER_LINE_ITEM_ID as i_WM_OUTPT_ORDER_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___i_LOAD_TSTMP as i_LOAD_TSTMP", \
	"EXP_UPD_VALIDATOR___UPDATE_TSTMP as UPDATE_TSTMP", \
	"EXP_UPD_VALIDATOR___LOAD_TSTMP as LOAD_TSTMP", \
	"EXP_UPD_VALIDATOR___o_UPDATE_VALIDATOR as o_UPDATE_VALIDATOR") \
	.withColumn('pyspark_data_action', when(col('o_UPDATE_VALIDATOR') ==(lit(1)),lit(0)).when(col('o_UPDATE_VALIDATOR') ==(lit(2)),lit(1)))

# COMMAND ----------
# Processing node Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM1, type TARGET 
# COLUMN COUNT: 101


Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM1 = UPD_INS_UPD.selectExpr(
	"CAST(LOCATION_ID AS BIGINT) as LOCATION_ID",
	"CAST(OUTPT_ORDER_LINE_ITEM_ID AS BIGINT) as WM_OUTPT_ORDER_LINE_ITEM_ID",
	"CAST(TC_COMPANY_ID AS INT) as WM_TC_COMPANY_ID",
	"CAST(TC_ORDER_ID AS STRING) as WM_TC_ORDER_ID",
	"CAST(TC_ORDER_LINE_ID AS STRING) as WM_TC_ORDER_LINE_ID",
	"CAST(TC_PURCHASE_ORDERS_ID AS STRING) as WM_TC_PURCHASE_ORDERS_ID",
	"CAST(PURCHASE_ORDER_NUMBER AS STRING) as WM_PURCHASE_ORDER_NBR",
	"CAST(PURCHASE_ORDER_LINE_NUMBER AS STRING) as WM_PURCHASE_ORDER_LINE_NBR",
	"CAST(EXT_PURCHASE_ORDER AS STRING) as WM_EXT_PURCHASE_ORDER",
	"CAST(LINE_ITEM_ID AS BIGINT) as WM_LINE_ITEM_ID",
	"CAST(PARENT_LINE_ITEM_ID AS BIGINT) as WM_PARENT_LINE_ITEM_ID",
	"CAST(INVC_BATCH_NBR AS INT) as WM_INVC_BATCH_NBR",
	"CAST(BATCH_CTRL_NBR AS STRING) as WM_BATCH_CTRL_NBR",
	"CAST(BATCH_NBR AS STRING) as WM_BATCH_NBR",
	"CAST(PROC_DTTM AS TIMESTAMP) as WM_PROC_TSTMP",
	"CAST(PROC_STAT_CODE AS SMALLINT) as WM_PROC_STAT_CD",
	"CAST(ITEM_ID AS INT) as WM_ITEM_ID",
	"CAST(ITEM_NAME AS STRING) as WM_ITEM_NAME",
	"CAST(GTIN AS STRING) as WM_GTIN",
	"CAST(ASSORT_NBR AS STRING) as WM_ASSORT_NBR",
	"CAST(PRODUCT_STATUS AS STRING) as WM_PRODUCT_STATUS",
	"CAST(REASON_CODE AS STRING) as WM_REASON_CD",
	"CAST(LINE_TYPE AS STRING) as WM_LINE_TYPE",
	"CAST(INVN_TYPE AS STRING) as WM_INVN_TYPE",
	"CAST(COMMODITY_CLASS AS STRING) as WM_COMMODITY_CLASS",
	"CAST(CUSTOMER_ITEM AS STRING) as WM_CUSTOMER_ITEM",
	"CAST(EXP_INFO_CODE AS STRING) as WM_EXP_INFO_CD",
	"CAST(CNTRY_OF_ORGN AS STRING) as COUNTRY_OF_ORIGIN",
	"CAST(MANUFACTURING_DTTM AS TIMESTAMP) as WM_MANUFACTURING_TSTMP",
	"CAST(PICKUP_REFERENCE_NUMBER AS STRING) as WM_PICKUP_REFERENCE_NBR",
	"CAST(PICKUP_START_DTTM AS TIMESTAMP) as WM_PICKUP_START_TSTMP",
	"CAST(PICKUP_END_DTTM AS TIMESTAMP) as WM_PICKUP_END_TSTMP",
	"CAST(PLANNED_SHIP_DATE AS TIMESTAMP) as WM_PLANNED_SHIP_TSTMP",
	"CAST(ACTUAL_SHIPPED_DTTM AS TIMESTAMP) as WM_ACTUAL_SHIPPED_TSTMP",
	"CAST(o_REC_PROC_FLAG AS TINYINT) as WM_REC_PROC_FLAG",
	"CAST(REC_XPANS_FIELD AS STRING) as WM_REC_XPANS_FIELD",
	"CAST(PLANNED_QUANTITY AS DECIMAL(13,4)) as PLANNED_QTY",
	"CAST(PLANNED_QUANTITY_UOM AS STRING) as WM_PLANNED_QTY_UOM",
	"CAST(ORDER_QTY AS DECIMAL(13,4)) as ORDER_QTY",
	"CAST(ORDER_QTY_UOM AS STRING) as WM_ORDER_QTY_UOM",
	"CAST(BACK_ORD_QTY AS DECIMAL(13,2)) as BACK_ORDERED_QTY",
	"CAST(USER_CANCELED_QTY AS DECIMAL(13,4)) as USER_CANCELED_QTY",
	"CAST(PPACK_QTY AS DECIMAL(13,4)) as WM_PPACK_QTY",
	"CAST(PPACK_GRP_CODE AS STRING) as WM_PPACK_GRP_CD",
	"CAST(SHIPPED_QTY AS DECIMAL(13,4)) as WM_SHIPPED_QTY",
	"CAST(PRICE AS DECIMAL(13,4)) as WM_PRICE",
	"CAST(PRICE_TKT_TYPE AS STRING) as WM_PRICE_TKT_TYPE",
	"CAST(RETAIL_PRICE AS DECIMAL(16,4)) as WM_RETAIL_PRICE",
	"CAST(ACTUAL_COST AS DECIMAL(13,4)) as WM_ACTUAL_COST",
	"CAST(ACTUAL_COST_CURRENCY_CODE AS STRING) as WM_ACTUAL_COST_CURRENCY_CD",
	"CAST(UNIT_VOL AS DECIMAL(16,4)) as UNIT_VOL",
	"CAST(UNIT_WT AS DECIMAL(16,4)) as UNIT_WT",
	"CAST(UOM AS STRING) as UOM",
	"CAST(AISLE AS STRING) as AISLE",
	"CAST(AREA AS STRING) as AREA",
	"CAST(BAY AS STRING) as BAY",
	"CAST(LVL AS STRING) as LVL",
	"CAST(POSN AS STRING) as POSN",
	"CAST(ZONE AS STRING) as ZONE",
	"CAST(TEMP_ZONE AS STRING) as TEMP_ZONE",
	"CAST(SIZE_RANGE_CODE AS STRING) as WM_SIZE_RANGE_CD",
	"CAST(SIZE_REL_POSN_IN_TABLE AS STRING) as SIZE_REL_POSN_IN_TABLE",
	"CAST(SHELF_DAYS AS INT) as SHELF_DAYS",
	"CAST(ITEM_COLOR AS STRING) as ITEM_COLOR",
	"CAST(ITEM_COLOR_SFX AS STRING) as ITEM_COLOR_SFX",
	"CAST(ITEM_SEASON AS STRING) as ITEM_SEASON",
	"CAST(ITEM_SEASON_YEAR AS STRING) as ITEM_SEASON_YEAR",
	"CAST(ITEM_SECOND_DIM AS STRING) as ITEM_SECOND_DIM",
	"CAST(ITEM_SIZE_DESC AS STRING) as ITEM_SIZE_DESC",
	"CAST(ITEM_QUALITY AS STRING) as ITEM_QUALITY",
	"CAST(ITEM_STYLE AS STRING) as ITEM_STYLE",
	"CAST(ITEM_STYLE_SFX AS STRING) as ITEM_STYLE_SFX",
	"CAST(ITEM_ATTR_1 AS STRING) as ITEM_ATTR_1",
	"CAST(ITEM_ATTR_2 AS STRING) as ITEM_ATTR_2",
	"CAST(ITEM_ATTR_3 AS STRING) as ITEM_ATTR_3",
	"CAST(ITEM_ATTR_4 AS STRING) as ITEM_ATTR_4",
	"CAST(ITEM_ATTR_5 AS STRING) as ITEM_ATTR_5",
	"CAST(MISC_INSTR_10_BYTE_1 AS STRING) as MISC_INSTR_10_BYTE_1",
	"CAST(MISC_INSTR_10_BYTE_2 AS STRING) as MISC_INSTR_10_BYTE_2",
	"CAST(ORIG_ORDER_LINE_ITEM_ID AS BIGINT) as WM_ORIG_ORDER_LINE_ITEM_ID",
	"CAST(ORIG_ITEM_ID AS INT) as WM_ORIG_ITEM_ID",
	"CAST(ORIG_ORDER_QTY AS DECIMAL(13,4)) as WM_ORIG_ORDER_QTY",
	"CAST(ORIG_ORDER_QTY_UOM AS STRING) as WM_ORIG_ORDER_QTY_UOM",
	"CAST(ORIG_ITEM_COLOR AS STRING) as ORIG_ITEM_COLOR",
	"CAST(ORIG_ITEM_COLOR_SFX AS STRING) as ORIG_ITEM_COLOR_SFX",
	"CAST(ORIG_ITEM_SEASON AS STRING) as ORIG_ITEM_SEASON",
	"CAST(ORIG_ITEM_SEASON_YEAR AS STRING) as ORIG_ITEM_SEASON_YEAR",
	"CAST(ORIG_ITEM_SECOND_DIM AS STRING) as ORIG_ITEM_SECOND_DIM",
	"CAST(ORIG_ITEM_SIZE_DESC AS STRING) as ORIG_ITEM_SIZE_DESC",
	"CAST(ORIG_ITEM_QUALITY AS STRING) as ORIG_ITEM_QUALITY",
	"CAST(ORIG_ITEM_STYLE AS STRING) as ORIG_ITEM_STYLE",
	"CAST(ORIG_ITEM_STYLE_SFX AS STRING) as ORIG_ITEM_STYLE_SFX",
	"CAST(VERSION_NBR AS BIGINT) as WM_VERSION_NBR",
	"CAST(CREATED_SOURCE_TYPE AS SMALLINT) as WM_CREATED_SOURCE_TYPE",
	"CAST(CREATED_SOURCE AS STRING) as WM_CREATED_SOURCE",
	"CAST(CREATED_DTTM AS TIMESTAMP) as WM_CREATED_TSTMP",
	"CAST(LAST_UPDATED_SOURCE_TYPE AS SMALLINT) as WM_LAST_UPDATED_SOURCE_TYPE",
	"CAST(LAST_UPDATED_SOURCE AS STRING) as WM_LAST_UPDATED_SOURCE",
	"CAST(LAST_UPDATED_DTTM AS TIMESTAMP) as WM_LAST_UPDATED_TSTMP",
	"CAST(UPDATE_TSTMP AS TIMESTAMP) as UPDATE_TSTMP",
	"CAST(LOAD_TSTMP AS TIMESTAMP) as LOAD_TSTMP" , 
    "pyspark_data_action"
)

try:
  primary_key = """source.LOCATION_ID = target.LOCATION_ID AND source.WM_OUTPT_ORDER_LINE_ITEM_ID = target.WM_OUTPT_ORDER_LINE_ITEM_ID"""
  # refined_perf_table = "WM_OUTPT_ORDER_LINE_ITEM"
  executeMerge(Shortcut_to_WM_OUTPT_ORDER_LINE_ITEM1, refined_perf_table, primary_key)
  logger.info(f"Merge with {refined_perf_table} completed]")
  logPrevRunDt("WM_OUTPT_ORDER_LINE_ITEM", "WM_OUTPT_ORDER_LINE_ITEM", "Completed", "N/A", f"{raw}.log_run_details")
except Exception as e:
  logPrevRunDt("WM_OUTPT_ORDER_LINE_ITEM", "WM_OUTPT_ORDER_LINE_ITEM","Failed",str(e), f"{raw}.log_run_details", )
  raise e

	