#Code converted on 2023-06-15 14:12:20
import os
import argparse
from pyspark.sql import *
from pyspark.sql.functions import *
from pyspark.sql.window import Window
from pyspark.sql.types import *
from datetime import datetime
from pyspark.dbutils import DBUtils
from Datalake.utils.genericUtilities import *
from Datalake.utils.configs import *
from Datalake.utils.mergeUtils import *
from Datalake.utils.logger import *

# COMMAND ----------

parser = argparse.ArgumentParser()
spark = SparkSession.getActiveSession()
dbutils = DBUtils(spark)

parser.add_argument('env', type=str, help='Env Variable')
# args = parser.parse_args()
# env = args.env
env = 'dev'


if env is None or env == '':
    raise ValueError('env is not set')

refine = getEnvPrefix(env) + 'refine'
raw = getEnvPrefix(env) + 'raw'
legacy = getEnvPrefix(env) + 'legacy'

# Set global variables
starttime = datetime.now() #start timestamp of the script
refined_perf_table = f"{refine}.WM_ASN_DETAIL"
raw_perf_table = f"{raw}.WM_ASN_DETAIL_PRE"
site_profile_table = f"{legacy}.SITE_PROFILE"


# COMMAND ----------
# Processing node SQ_Shortcut_to_WM_ASN_DETAIL, type SOURCE 
# COLUMN COUNT: 5

SQ_Shortcut_to_WM_ASN_DETAIL = (spark.sql(f"""SELECT
LOCATION_ID,
WM_ASN_DETAIL_ID,
WM_CREATED_TSTMP,
WM_LAST_UPDATED_TSTMP,
LOAD_TSTMP
FROM {refined_perf_table}
WHERE WM_ASN_DETAIL_ID IN (SELECT ASN_DETAIL_ID FROM {raw_perf_table})""")
).withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node SQ_Shortcut_to_WM_ASN_DETAIL_PRE, type SOURCE 
# COLUMN COUNT: 100

SQ_Shortcut_to_WM_ASN_DETAIL_PRE = (spark.sql(f"""SELECT
DC_NBR,
ASN_DETAIL_ID,
ASN_ID,
TC_PURCHASE_ORDERS_ID,
PURCHASE_ORDERS_ID,
SKU_ID,
SKU_NAME,
SKU_ATTR_1,
SKU_ATTR_2,
SKU_ATTR_3,
SKU_ATTR_4,
SKU_ATTR_5,
BUSINESS_PARTNER_ID,
PACKAGE_TYPE_ID,
PACKAGE_TYPE_DESC,
PACKAGE_TYPE_INSTANCE,
EPC_TRACKING_RFID_VALUE,
ORDER_TYPE_DESC,
GTIN,
SHIPPED_QTY,
STD_PACK_QTY,
STD_CASE_QTY,
ASN_DETAIL_STATUS,
RECEIVED_QTY,
STD_SUB_PACK_QTY,
LPN_PER_TIER,
TIER_PER_PALLET,
MFG_DATE,
SHIP_BY_DATE,
MFG_PLNT,
EXPIRE_DATE,
INCUBATION_DATE,
EPC_REQ_ON_ALL_CASES,
WEIGHT_UOM_ID_BASE,
REGION_ID,
IS_ASSOCIATED_TO_OUTBOUND,
IS_CANCELLED,
IS_CLOSED,
INVN_TYPE,
PROD_STAT,
BATCH_NBR,
CNTRY_OF_ORGN,
SHIPPED_LPN_COUNT,
RECEIVED_LPN_COUNT,
UNITS_ASSIGNED_TO_LPN,
PROC_IMMD_NEEDS,
QUALITY_CHECK_HOLD_UPON_RCPT,
REFERENCE_ORDER_NBR,
ACTUAL_WEIGHT,
ACTUAL_WEIGHT_PACK_COUNT,
NBR_OF_PACK_FOR_CATCH_WT,
PUTWY_TYPE,
RETAIL_PRICE,
PRICE_TIX_AVAIL,
CREATED_SOURCE_TYPE,
CREATED_SOURCE,
CREATED_DTTM,
LAST_UPDATED_SOURCE_TYPE,
LAST_UPDATED_SOURCE,
LAST_UPDATED_DTTM,
HIBERNATE_VERSION,
TC_COMPANY_ID,
TC_PO_LINE_ID,
INVENTORY_SEGMENT_ID,
PPACK_GRP_CODE,
CUT_NBR,
QTY_CONV_FACTOR,
QTY_UOM_ID,
WEIGHT_UOM_ID,
QTY_UOM_ID_BASE,
TC_ORDER_ID,
ORDER_ID,
TC_ORDER_LINE_ID,
ORDER_LINE_ITEM_ID,
SEQ_NBR,
EXP_RECEIVE_CONDITION_CODE,
ASN_RECV_RULES,
CHECKSUM,
ACTUAL_WEIGHT_RECEIVED,
REF_FIELD_1,
REF_FIELD_3,
REF_FIELD_2,
REF_FIELD_4,
REF_FIELD_5,
REF_FIELD_6,
REF_FIELD_7,
REF_FIELD_8,
REF_FIELD_9,
REF_FIELD_10,
REF_NUM1,
REF_NUM2,
REF_NUM3,
REF_NUM4,
REF_NUM5,
DISPOSITION_TYPE,
PRE_RECEIPT_STATUS,
INV_DISPOSITION,
EXT_PLAN_ID,
PURCHASE_ORDERS_LINE_ITEM_ID,
PROCESSED_FOR_TRLR_MOVES
FROM WM_ASN_DETAIL_PRE""")
).withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node EXP_INT_CONVERSION, type EXPRESSION 
# COLUMN COUNT: 100

# for each involved DataFrame, append the dataframe name to each column
SQ_Shortcut_to_WM_ASN_DETAIL_PRE_temp = SQ_Shortcut_to_WM_ASN_DETAIL_PRE.toDF(*["SQ_Shortcut_to_WM_ASN_DETAIL_PRE___" + col for col in SQ_Shortcut_to_WM_ASN_DETAIL_PRE.columns])

EXP_INT_CONVERSION = SQ_Shortcut_to_WM_ASN_DETAIL_PRE_temp.selectExpr( \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___sys_row_id as sys_row_id", \
	"cast(SQ_Shortcut_to_WM_ASN_DETAIL_PRE___DC_NBR as int) as o_DC_NBR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ASN_ID as ASN_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ID as SKU_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_NAME as SKU_NAME", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ATTR_1 as SKU_ATTR_1", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ATTR_2 as SKU_ATTR_2", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ATTR_3 as SKU_ATTR_3", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ATTR_4 as SKU_ATTR_4", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SKU_ATTR_5 as SKU_ATTR_5", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___GTIN as GTIN", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SHIPPED_QTY as SHIPPED_QTY", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___STD_PACK_QTY as STD_PACK_QTY", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___STD_CASE_QTY as STD_CASE_QTY", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___RECEIVED_QTY as RECEIVED_QTY", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___LPN_PER_TIER as LPN_PER_TIER", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TIER_PER_PALLET as TIER_PER_PALLET", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___MFG_DATE as MFG_DATE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SHIP_BY_DATE as SHIP_BY_DATE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___MFG_PLNT as MFG_PLNT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___EXPIRE_DATE as EXPIRE_DATE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___INCUBATION_DATE as INCUBATION_DATE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___EPC_REQ_ON_ALL_CASES as EPC_REQ_ON_ALL_CASES", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REGION_ID as REGION_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___IS_CANCELLED as IS_CANCELLED", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___IS_CLOSED as IS_CLOSED", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___INVN_TYPE as INVN_TYPE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PROD_STAT as PROD_STAT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___BATCH_NBR as BATCH_NBR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PROC_IMMD_NEEDS as PROC_IMMD_NEEDS", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___QUALITY_CHECK_HOLD_UPON_RCPT as QUALITY_CHECK_HOLD_UPON_RCPT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PUTWY_TYPE as PUTWY_TYPE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___RETAIL_PRICE as RETAIL_PRICE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PRICE_TIX_AVAIL as PRICE_TIX_AVAIL", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CREATED_SOURCE as CREATED_SOURCE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CREATED_DTTM as CREATED_DTTM", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TC_COMPANY_ID as TC_COMPANY_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CUT_NBR as CUT_NBR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___QTY_UOM_ID as QTY_UOM_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TC_ORDER_ID as TC_ORDER_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ORDER_ID as ORDER_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___SEQ_NBR as SEQ_NBR", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ASN_RECV_RULES as ASN_RECV_RULES", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___CHECKSUM as CHECKSUM", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_1 as REF_FIELD_1", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_3 as REF_FIELD_3", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_2 as REF_FIELD_2", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_4 as REF_FIELD_4", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_5 as REF_FIELD_5", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_6 as REF_FIELD_6", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_7 as REF_FIELD_7", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_8 as REF_FIELD_8", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_9 as REF_FIELD_9", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_FIELD_10 as REF_FIELD_10", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_NUM1 as REF_NUM1", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_NUM2 as REF_NUM2", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_NUM3 as REF_NUM3", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_NUM4 as REF_NUM4", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___REF_NUM5 as REF_NUM5", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___INV_DISPOSITION as INV_DISPOSITION", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___EXT_PLAN_ID as EXT_PLAN_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL_PRE___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES" \
)

# COMMAND ----------
# Processing node SQ_Shortcut_to_SITE_PROFILE, type SOURCE 
# COLUMN COUNT: 2

SQ_Shortcut_to_SITE_PROFILE = spark.sql(f"""SELECT LOCATION_ID, STORE_NBR FROM {site_profile_table}""").withColumn("sys_row_id", monotonically_increasing_id())

# COMMAND ----------
# Processing node JNR_SITE_PROFILE, type JOINER 
# COLUMN COUNT: 102

JNR_SITE_PROFILE = SQ_Shortcut_to_SITE_PROFILE.join(EXP_INT_CONVERSION,[SQ_Shortcut_to_SITE_PROFILE.STORE_NBR == EXP_INT_CONVERSION.o_DC_NBR],'inner')

# COMMAND ----------
# Processing node JNR_WM_ASN_DETAIL, type JOINER . Note: using additional SELECT to rename incoming columns
# COLUMN COUNT: 105

# for each involved DataFrame, append the dataframe name to each column
SQ_Shortcut_to_WM_ASN_DETAIL_temp = SQ_Shortcut_to_WM_ASN_DETAIL.toDF(*["SQ_Shortcut_to_WM_ASN_DETAIL___" + col for col in SQ_Shortcut_to_WM_ASN_DETAIL.columns])
JNR_SITE_PROFILE_temp = JNR_SITE_PROFILE.toDF(*["JNR_SITE_PROFILE___" + col for col in JNR_SITE_PROFILE.columns])

JNR_WM_ASN_DETAIL = SQ_Shortcut_to_WM_ASN_DETAIL_temp.join(JNR_SITE_PROFILE_temp,[SQ_Shortcut_to_WM_ASN_DETAIL_temp.SQ_Shortcut_to_WM_ASN_DETAIL___LOCATION_ID == JNR_SITE_PROFILE_temp.JNR_SITE_PROFILE___LOCATION_ID, SQ_Shortcut_to_WM_ASN_DETAIL_temp.SQ_Shortcut_to_WM_ASN_DETAIL___WM_ASN_DETAIL_ID == JNR_SITE_PROFILE_temp.JNR_SITE_PROFILE___ASN_DETAIL_ID],'right_outer').selectExpr( \
	"JNR_SITE_PROFILE___LOCATION_ID as LOCATION_ID", \
	"JNR_SITE_PROFILE___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"JNR_SITE_PROFILE___ASN_ID as ASN_ID", \
	"JNR_SITE_PROFILE___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"JNR_SITE_PROFILE___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"JNR_SITE_PROFILE___SKU_ID as SKU_ID", \
	"JNR_SITE_PROFILE___SKU_NAME as SKU_NAME", \
	"JNR_SITE_PROFILE___SKU_ATTR_1 as SKU_ATTR_1", \
	"JNR_SITE_PROFILE___SKU_ATTR_2 as SKU_ATTR_2", \
	"JNR_SITE_PROFILE___SKU_ATTR_3 as SKU_ATTR_3", \
	"JNR_SITE_PROFILE___SKU_ATTR_4 as SKU_ATTR_4", \
	"JNR_SITE_PROFILE___SKU_ATTR_5 as SKU_ATTR_5", \
	"JNR_SITE_PROFILE___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"JNR_SITE_PROFILE___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"JNR_SITE_PROFILE___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"JNR_SITE_PROFILE___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"JNR_SITE_PROFILE___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"JNR_SITE_PROFILE___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"JNR_SITE_PROFILE___GTIN as GTIN", \
	"JNR_SITE_PROFILE___SHIPPED_QTY as SHIPPED_QTY", \
	"JNR_SITE_PROFILE___STD_PACK_QTY as STD_PACK_QTY", \
	"JNR_SITE_PROFILE___STD_CASE_QTY as STD_CASE_QTY", \
	"JNR_SITE_PROFILE___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"JNR_SITE_PROFILE___RECEIVED_QTY as RECEIVED_QTY", \
	"JNR_SITE_PROFILE___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"JNR_SITE_PROFILE___LPN_PER_TIER as LPN_PER_TIER", \
	"JNR_SITE_PROFILE___TIER_PER_PALLET as TIER_PER_PALLET", \
	"JNR_SITE_PROFILE___MFG_DATE as MFG_DATE", \
	"JNR_SITE_PROFILE___SHIP_BY_DATE as SHIP_BY_DATE", \
	"JNR_SITE_PROFILE___MFG_PLNT as MFG_PLNT", \
	"JNR_SITE_PROFILE___EXPIRE_DATE as EXPIRE_DATE", \
	"JNR_SITE_PROFILE___INCUBATION_DATE as INCUBATION_DATE", \
	"JNR_SITE_PROFILE___EPC_REQ_ON_ALL_CASES as EPC_REQ_ON_ALL_CASES", \
	"JNR_SITE_PROFILE___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"JNR_SITE_PROFILE___REGION_ID as REGION_ID", \
	"JNR_SITE_PROFILE___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"JNR_SITE_PROFILE___IS_CANCELLED as IS_CANCELLED", \
	"JNR_SITE_PROFILE___IS_CLOSED as IS_CLOSED", \
	"JNR_SITE_PROFILE___INVN_TYPE as INVN_TYPE", \
	"JNR_SITE_PROFILE___PROD_STAT as PROD_STAT", \
	"JNR_SITE_PROFILE___BATCH_NBR as BATCH_NBR", \
	"JNR_SITE_PROFILE___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"JNR_SITE_PROFILE___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"JNR_SITE_PROFILE___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"JNR_SITE_PROFILE___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
	"JNR_SITE_PROFILE___PROC_IMMD_NEEDS as PROC_IMMD_NEEDS", \
	"JNR_SITE_PROFILE___QUALITY_CHECK_HOLD_UPON_RCPT as QUALITY_CHECK_HOLD_UPON_RCPT", \
	"JNR_SITE_PROFILE___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"JNR_SITE_PROFILE___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"JNR_SITE_PROFILE___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"JNR_SITE_PROFILE___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"JNR_SITE_PROFILE___PUTWY_TYPE as PUTWY_TYPE", \
	"JNR_SITE_PROFILE___RETAIL_PRICE as RETAIL_PRICE", \
	"JNR_SITE_PROFILE___PRICE_TIX_AVAIL as PRICE_TIX_AVAIL", \
	"JNR_SITE_PROFILE___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"JNR_SITE_PROFILE___CREATED_SOURCE as CREATED_SOURCE", \
	"JNR_SITE_PROFILE___CREATED_DTTM as CREATED_DTTM", \
	"JNR_SITE_PROFILE___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"JNR_SITE_PROFILE___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"JNR_SITE_PROFILE___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"JNR_SITE_PROFILE___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"JNR_SITE_PROFILE___TC_COMPANY_ID as TC_COMPANY_ID", \
	"JNR_SITE_PROFILE___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"JNR_SITE_PROFILE___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"JNR_SITE_PROFILE___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"JNR_SITE_PROFILE___CUT_NBR as CUT_NBR", \
	"JNR_SITE_PROFILE___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"JNR_SITE_PROFILE___QTY_UOM_ID as QTY_UOM_ID", \
	"JNR_SITE_PROFILE___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"JNR_SITE_PROFILE___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"JNR_SITE_PROFILE___TC_ORDER_ID as TC_ORDER_ID", \
	"JNR_SITE_PROFILE___ORDER_ID as ORDER_ID", \
	"JNR_SITE_PROFILE___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"JNR_SITE_PROFILE___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___SEQ_NBR as SEQ_NBR", \
	"JNR_SITE_PROFILE___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"JNR_SITE_PROFILE___ASN_RECV_RULES as ASN_RECV_RULES", \
	"JNR_SITE_PROFILE___CHECKSUM as CHECKSUM", \
	"JNR_SITE_PROFILE___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"JNR_SITE_PROFILE___REF_FIELD_1 as REF_FIELD_1", \
	"JNR_SITE_PROFILE___REF_FIELD_3 as REF_FIELD_3", \
	"JNR_SITE_PROFILE___REF_FIELD_2 as REF_FIELD_2", \
	"JNR_SITE_PROFILE___REF_FIELD_4 as REF_FIELD_4", \
	"JNR_SITE_PROFILE___REF_FIELD_5 as REF_FIELD_5", \
	"JNR_SITE_PROFILE___REF_FIELD_6 as REF_FIELD_6", \
	"JNR_SITE_PROFILE___REF_FIELD_7 as REF_FIELD_7", \
	"JNR_SITE_PROFILE___REF_FIELD_8 as REF_FIELD_8", \
	"JNR_SITE_PROFILE___REF_FIELD_9 as REF_FIELD_9", \
	"JNR_SITE_PROFILE___REF_FIELD_10 as REF_FIELD_10", \
	"JNR_SITE_PROFILE___REF_NUM1 as REF_NUM1", \
	"JNR_SITE_PROFILE___REF_NUM2 as REF_NUM2", \
	"JNR_SITE_PROFILE___REF_NUM3 as REF_NUM3", \
	"JNR_SITE_PROFILE___REF_NUM4 as REF_NUM4", \
	"JNR_SITE_PROFILE___REF_NUM5 as REF_NUM5", \
	"JNR_SITE_PROFILE___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"JNR_SITE_PROFILE___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"JNR_SITE_PROFILE___INV_DISPOSITION as INV_DISPOSITION", \
	"JNR_SITE_PROFILE___EXT_PLAN_ID as EXT_PLAN_ID", \
	"JNR_SITE_PROFILE___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"JNR_SITE_PROFILE___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES", \
	"SQ_Shortcut_to_WM_ASN_DETAIL___LOCATION_ID as i_LOCATION_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL___WM_ASN_DETAIL_ID as i_WM_ASN_DETAIL_ID", \
	"SQ_Shortcut_to_WM_ASN_DETAIL___WM_CREATED_TSTMP as i_WM_CREATED_TSTMP", \
	"SQ_Shortcut_to_WM_ASN_DETAIL___WM_LAST_UPDATED_TSTMP as i_WM_LAST_UPDATED_TSTMP", \
	"SQ_Shortcut_to_WM_ASN_DETAIL___LOAD_TSTMP as i_LOAD_TSTMP")

# COMMAND ----------
# Processing node FIL_UNCHANGED_RECORDS, type FILTER 
# COLUMN COUNT: 104

# for each involved DataFrame, append the dataframe name to each column
JNR_WM_ASN_DETAIL_temp = JNR_WM_ASN_DETAIL.toDF(*["JNR_WM_ASN_DETAIL___" + col for col in JNR_WM_ASN_DETAIL.columns])

FIL_UNCHANGED_RECORDS = JNR_WM_ASN_DETAIL_temp.selectExpr( \
	"JNR_WM_ASN_DETAIL___LOCATION_ID as LOCATION_ID", \
	"JNR_WM_ASN_DETAIL___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"JNR_WM_ASN_DETAIL___ASN_ID as ASN_ID", \
	"JNR_WM_ASN_DETAIL___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"JNR_WM_ASN_DETAIL___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"JNR_WM_ASN_DETAIL___SKU_ID as SKU_ID", \
	"JNR_WM_ASN_DETAIL___SKU_NAME as SKU_NAME", \
	"JNR_WM_ASN_DETAIL___SKU_ATTR_1 as SKU_ATTR_1", \
	"JNR_WM_ASN_DETAIL___SKU_ATTR_2 as SKU_ATTR_2", \
	"JNR_WM_ASN_DETAIL___SKU_ATTR_3 as SKU_ATTR_3", \
	"JNR_WM_ASN_DETAIL___SKU_ATTR_4 as SKU_ATTR_4", \
	"JNR_WM_ASN_DETAIL___SKU_ATTR_5 as SKU_ATTR_5", \
	"JNR_WM_ASN_DETAIL___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"JNR_WM_ASN_DETAIL___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"JNR_WM_ASN_DETAIL___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"JNR_WM_ASN_DETAIL___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"JNR_WM_ASN_DETAIL___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"JNR_WM_ASN_DETAIL___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"JNR_WM_ASN_DETAIL___GTIN as GTIN", \
	"JNR_WM_ASN_DETAIL___SHIPPED_QTY as SHIPPED_QTY", \
	"JNR_WM_ASN_DETAIL___STD_PACK_QTY as STD_PACK_QTY", \
	"JNR_WM_ASN_DETAIL___STD_CASE_QTY as STD_CASE_QTY", \
	"JNR_WM_ASN_DETAIL___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"JNR_WM_ASN_DETAIL___RECEIVED_QTY as RECEIVED_QTY", \
	"JNR_WM_ASN_DETAIL___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"JNR_WM_ASN_DETAIL___LPN_PER_TIER as LPN_PER_TIER", \
	"JNR_WM_ASN_DETAIL___TIER_PER_PALLET as TIER_PER_PALLET", \
	"JNR_WM_ASN_DETAIL___MFG_DATE as MFG_DATE", \
	"JNR_WM_ASN_DETAIL___SHIP_BY_DATE as SHIP_BY_DATE", \
	"JNR_WM_ASN_DETAIL___MFG_PLNT as MFG_PLNT", \
	"JNR_WM_ASN_DETAIL___EXPIRE_DATE as EXPIRE_DATE", \
	"JNR_WM_ASN_DETAIL___INCUBATION_DATE as INCUBATION_DATE", \
	"JNR_WM_ASN_DETAIL___EPC_REQ_ON_ALL_CASES as EPC_REQ_ON_ALL_CASES", \
	"JNR_WM_ASN_DETAIL___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"JNR_WM_ASN_DETAIL___REGION_ID as REGION_ID", \
	"JNR_WM_ASN_DETAIL___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"JNR_WM_ASN_DETAIL___IS_CANCELLED as IS_CANCELLED", \
	"JNR_WM_ASN_DETAIL___IS_CLOSED as IS_CLOSED", \
	"JNR_WM_ASN_DETAIL___INVN_TYPE as INVN_TYPE", \
	"JNR_WM_ASN_DETAIL___PROD_STAT as PROD_STAT", \
	"JNR_WM_ASN_DETAIL___BATCH_NBR as BATCH_NBR", \
	"JNR_WM_ASN_DETAIL___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"JNR_WM_ASN_DETAIL___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"JNR_WM_ASN_DETAIL___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"JNR_WM_ASN_DETAIL___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
	"JNR_WM_ASN_DETAIL___PROC_IMMD_NEEDS as PROC_IMMD_NEEDS", \
	"JNR_WM_ASN_DETAIL___QUALITY_CHECK_HOLD_UPON_RCPT as QUALITY_CHECK_HOLD_UPON_RCPT", \
	"JNR_WM_ASN_DETAIL___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"JNR_WM_ASN_DETAIL___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"JNR_WM_ASN_DETAIL___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"JNR_WM_ASN_DETAIL___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"JNR_WM_ASN_DETAIL___PUTWY_TYPE as PUTWY_TYPE", \
	"JNR_WM_ASN_DETAIL___RETAIL_PRICE as RETAIL_PRICE", \
	"JNR_WM_ASN_DETAIL___PRICE_TIX_AVAIL as PRICE_TIX_AVAIL", \
	"JNR_WM_ASN_DETAIL___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"JNR_WM_ASN_DETAIL___CREATED_SOURCE as CREATED_SOURCE", \
	"JNR_WM_ASN_DETAIL___CREATED_DTTM as CREATED_DTTM", \
	"JNR_WM_ASN_DETAIL___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"JNR_WM_ASN_DETAIL___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"JNR_WM_ASN_DETAIL___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"JNR_WM_ASN_DETAIL___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"JNR_WM_ASN_DETAIL___TC_COMPANY_ID as TC_COMPANY_ID", \
	"JNR_WM_ASN_DETAIL___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"JNR_WM_ASN_DETAIL___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"JNR_WM_ASN_DETAIL___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"JNR_WM_ASN_DETAIL___CUT_NBR as CUT_NBR", \
	"JNR_WM_ASN_DETAIL___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"JNR_WM_ASN_DETAIL___QTY_UOM_ID as QTY_UOM_ID", \
	"JNR_WM_ASN_DETAIL___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"JNR_WM_ASN_DETAIL___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"JNR_WM_ASN_DETAIL___TC_ORDER_ID as TC_ORDER_ID", \
	"JNR_WM_ASN_DETAIL___ORDER_ID as ORDER_ID", \
	"JNR_WM_ASN_DETAIL___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"JNR_WM_ASN_DETAIL___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"JNR_WM_ASN_DETAIL___SEQ_NBR as SEQ_NBR", \
	"JNR_WM_ASN_DETAIL___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"JNR_WM_ASN_DETAIL___ASN_RECV_RULES as ASN_RECV_RULES", \
	"JNR_WM_ASN_DETAIL___CHECKSUM as CHECKSUM", \
	"JNR_WM_ASN_DETAIL___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_1 as REF_FIELD_1", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_3 as REF_FIELD_3", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_2 as REF_FIELD_2", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_4 as REF_FIELD_4", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_5 as REF_FIELD_5", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_6 as REF_FIELD_6", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_7 as REF_FIELD_7", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_8 as REF_FIELD_8", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_9 as REF_FIELD_9", \
	"JNR_WM_ASN_DETAIL___REF_FIELD_10 as REF_FIELD_10", \
	"JNR_WM_ASN_DETAIL___REF_NUM1 as REF_NUM1", \
	"JNR_WM_ASN_DETAIL___REF_NUM2 as REF_NUM2", \
	"JNR_WM_ASN_DETAIL___REF_NUM3 as REF_NUM3", \
	"JNR_WM_ASN_DETAIL___REF_NUM4 as REF_NUM4", \
	"JNR_WM_ASN_DETAIL___REF_NUM5 as REF_NUM5", \
	"JNR_WM_ASN_DETAIL___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"JNR_WM_ASN_DETAIL___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"JNR_WM_ASN_DETAIL___INV_DISPOSITION as INV_DISPOSITION", \
	"JNR_WM_ASN_DETAIL___EXT_PLAN_ID as EXT_PLAN_ID", \
	"JNR_WM_ASN_DETAIL___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"JNR_WM_ASN_DETAIL___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES", \
	"JNR_WM_ASN_DETAIL___i_WM_ASN_DETAIL_ID as i_WM_ASN_DETAIL_ID", \
	"JNR_WM_ASN_DETAIL___i_WM_CREATED_TSTMP as i_WM_CREATED_TSTMP", \
	"JNR_WM_ASN_DETAIL___i_WM_LAST_UPDATED_TSTMP as i_WM_LAST_UPDATED_TSTMP", \
	"JNR_WM_ASN_DETAIL___i_LOAD_TSTMP as i_LOAD_TSTMP") \
	.filter("i_WM_ASN_DETAIL_ID is Null OR ( i_WM_ASN_DETAIL_ID is Not Null AND ( COALESCE(CREATED_DTTM, date'1900-01-01') != COALESCE(i_WM_CREATE_TSTMP, date'1900-01-01') \
         OR COALESCE(LAST_UPDATED_DTTM, date'1900-01-01') != COALESCE(i_WM_LAST_UPDATED_TSTMP, date'1900-01-01')))") \
.withColumn("sys_row_id", monotonically_increasing_id())


# COMMAND ----------
# Processing node EXP_UPD_VALIDATOR, type EXPRESSION . Note: using additional SELECT to rename incoming columns
# COLUMN COUNT: 103

# for each involved DataFrame, append the dataframe name to each column
FIL_UNCHANGED_RECORDS_temp = FIL_UNCHANGED_RECORDS.toDF(*["FIL_UNCHANGED_RECORDS___" + col for col in FIL_UNCHANGED_RECORDS.columns])

EXP_UPD_VALIDATOR = FIL_UNCHANGED_RECORDS_temp.selectExpr( \
	"FIL_UNCHANGED_RECORDS___LOCATION_ID as LOCATION_ID", \
	"FIL_UNCHANGED_RECORDS___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"FIL_UNCHANGED_RECORDS___ASN_ID as ASN_ID", \
	"FIL_UNCHANGED_RECORDS___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"FIL_UNCHANGED_RECORDS___SKU_ID as SKU_ID", \
	"FIL_UNCHANGED_RECORDS___SKU_NAME as SKU_NAME", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_1 as SKU_ATTR_1", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_2 as SKU_ATTR_2", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_3 as SKU_ATTR_3", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_4 as SKU_ATTR_4", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_5 as SKU_ATTR_5", \
	"FIL_UNCHANGED_RECORDS___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"FIL_UNCHANGED_RECORDS___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"FIL_UNCHANGED_RECORDS___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"FIL_UNCHANGED_RECORDS___GTIN as GTIN", \
	"FIL_UNCHANGED_RECORDS___SHIPPED_QTY as SHIPPED_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_PACK_QTY as STD_PACK_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_CASE_QTY as STD_CASE_QTY", \
	"FIL_UNCHANGED_RECORDS___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"FIL_UNCHANGED_RECORDS___RECEIVED_QTY as RECEIVED_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"FIL_UNCHANGED_RECORDS___LPN_PER_TIER as LPN_PER_TIER", \
	"FIL_UNCHANGED_RECORDS___TIER_PER_PALLET as TIER_PER_PALLET", \
	"FIL_UNCHANGED_RECORDS___MFG_DATE as MFG_DATE", \
	"FIL_UNCHANGED_RECORDS___SHIP_BY_DATE as SHIP_BY_DATE", \
	"FIL_UNCHANGED_RECORDS___MFG_PLNT as MFG_PLNT", \
	"FIL_UNCHANGED_RECORDS___EXPIRE_DATE as EXPIRE_DATE", \
	"FIL_UNCHANGED_RECORDS___INCUBATION_DATE as INCUBATION_DATE", \
	"FIL_UNCHANGED_RECORDS___EPC_REQ_ON_ALL_CASES as EPC_REQ_ON_ALL_CASES", \
	"FIL_UNCHANGED_RECORDS___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"FIL_UNCHANGED_RECORDS___REGION_ID as REGION_ID", \
	"FIL_UNCHANGED_RECORDS___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"FIL_UNCHANGED_RECORDS___IS_CANCELLED as IS_CANCELLED", \
	"FIL_UNCHANGED_RECORDS___IS_CLOSED as IS_CLOSED", \
	"FIL_UNCHANGED_RECORDS___INVN_TYPE as INVN_TYPE", \
	"FIL_UNCHANGED_RECORDS___PROD_STAT as PROD_STAT", \
	"FIL_UNCHANGED_RECORDS___BATCH_NBR as BATCH_NBR", \
	"FIL_UNCHANGED_RECORDS___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"FIL_UNCHANGED_RECORDS___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"FIL_UNCHANGED_RECORDS___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"FIL_UNCHANGED_RECORDS___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
	"FIL_UNCHANGED_RECORDS___PROC_IMMD_NEEDS as PROC_IMMD_NEEDS", \
	"FIL_UNCHANGED_RECORDS___QUALITY_CHECK_HOLD_UPON_RCPT as QUALITY_CHECK_HOLD_UPON_RCPT", \
	"FIL_UNCHANGED_RECORDS___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"FIL_UNCHANGED_RECORDS___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"FIL_UNCHANGED_RECORDS___PUTWY_TYPE as PUTWY_TYPE", \
	"FIL_UNCHANGED_RECORDS___RETAIL_PRICE as RETAIL_PRICE", \
	"FIL_UNCHANGED_RECORDS___PRICE_TIX_AVAIL as PRICE_TIX_AVAIL", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE as CREATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___CREATED_DTTM as CREATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"FIL_UNCHANGED_RECORDS___TC_COMPANY_ID as TC_COMPANY_ID", \
	"FIL_UNCHANGED_RECORDS___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"FIL_UNCHANGED_RECORDS___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"FIL_UNCHANGED_RECORDS___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"FIL_UNCHANGED_RECORDS___CUT_NBR as CUT_NBR", \
	"FIL_UNCHANGED_RECORDS___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"FIL_UNCHANGED_RECORDS___QTY_UOM_ID as QTY_UOM_ID", \
	"FIL_UNCHANGED_RECORDS___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"FIL_UNCHANGED_RECORDS___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_ID as TC_ORDER_ID", \
	"FIL_UNCHANGED_RECORDS___ORDER_ID as ORDER_ID", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"FIL_UNCHANGED_RECORDS___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___SEQ_NBR as SEQ_NBR", \
	"FIL_UNCHANGED_RECORDS___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"FIL_UNCHANGED_RECORDS___ASN_RECV_RULES as ASN_RECV_RULES", \
	"FIL_UNCHANGED_RECORDS___CHECKSUM as CHECKSUM", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_1 as REF_FIELD_1", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_3 as REF_FIELD_31", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_2 as REF_FIELD_2", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_4 as REF_FIELD_4", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_5 as REF_FIELD_5", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_6 as REF_FIELD_6", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_7 as REF_FIELD_7", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_8 as REF_FIELD_8", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_9 as REF_FIELD_9", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_10 as REF_FIELD_10", \
	"FIL_UNCHANGED_RECORDS___REF_NUM1 as REF_NUM1", \
	"FIL_UNCHANGED_RECORDS___REF_NUM2 as REF_NUM2", \
	"FIL_UNCHANGED_RECORDS___REF_NUM3 as REF_NUM3", \
	"FIL_UNCHANGED_RECORDS___REF_NUM4 as REF_NUM4", \
	"FIL_UNCHANGED_RECORDS___REF_NUM5 as REF_NUM5", \
	"FIL_UNCHANGED_RECORDS___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"FIL_UNCHANGED_RECORDS___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"FIL_UNCHANGED_RECORDS___INV_DISPOSITION as INV_DISPOSITION", \
	"FIL_UNCHANGED_RECORDS___EXT_PLAN_ID as EXT_PLAN_ID", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES", \
	"FIL_UNCHANGED_RECORDS___i_WM_ASN_DETAIL_ID as i_WM_ASN_DETAIL_ID", \
	"FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP as i_LOAD_TSTMP").selectExpr( \
	"FIL_UNCHANGED_RECORDS___sys_row_id as sys_row_id", \
	"FIL_UNCHANGED_RECORDS___LOCATION_ID as LOCATION_ID", \
	"FIL_UNCHANGED_RECORDS___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"FIL_UNCHANGED_RECORDS___ASN_ID as ASN_ID", \
	"FIL_UNCHANGED_RECORDS___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"FIL_UNCHANGED_RECORDS___SKU_ID as SKU_ID", \
	"FIL_UNCHANGED_RECORDS___SKU_NAME as SKU_NAME", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_1 as SKU_ATTR_1", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_2 as SKU_ATTR_2", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_3 as SKU_ATTR_3", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_4 as SKU_ATTR_4", \
	"FIL_UNCHANGED_RECORDS___SKU_ATTR_5 as SKU_ATTR_5", \
	"FIL_UNCHANGED_RECORDS___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"FIL_UNCHANGED_RECORDS___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"FIL_UNCHANGED_RECORDS___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"FIL_UNCHANGED_RECORDS___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"FIL_UNCHANGED_RECORDS___GTIN as GTIN", \
	"FIL_UNCHANGED_RECORDS___SHIPPED_QTY as SHIPPED_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_PACK_QTY as STD_PACK_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_CASE_QTY as STD_CASE_QTY", \
	"FIL_UNCHANGED_RECORDS___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"FIL_UNCHANGED_RECORDS___RECEIVED_QTY as RECEIVED_QTY", \
	"FIL_UNCHANGED_RECORDS___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"FIL_UNCHANGED_RECORDS___LPN_PER_TIER as LPN_PER_TIER", \
	"FIL_UNCHANGED_RECORDS___TIER_PER_PALLET as TIER_PER_PALLET", \
	"FIL_UNCHANGED_RECORDS___MFG_DATE as MFG_DATE", \
	"FIL_UNCHANGED_RECORDS___SHIP_BY_DATE as SHIP_BY_DATE", \
	"FIL_UNCHANGED_RECORDS___MFG_PLNT as MFG_PLNT", \
	"FIL_UNCHANGED_RECORDS___EXPIRE_DATE as EXPIRE_DATE", \
	"FIL_UNCHANGED_RECORDS___INCUBATION_DATE as INCUBATION_DATE", \
    "CASE WHEN TRIM(UPPER(FIL_UNCHANGED_RECORDS___EPC_REQ_ON_ALL_CASES)) IN ('Y', '1') THEN '1' ELSE '0' END as EPC_REQ_ON_ALL_CASES_EXP", \
	"FIL_UNCHANGED_RECORDS___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"FIL_UNCHANGED_RECORDS___REGION_ID as REGION_ID", \
	"FIL_UNCHANGED_RECORDS___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"FIL_UNCHANGED_RECORDS___IS_CANCELLED as IS_CANCELLED", \
	"FIL_UNCHANGED_RECORDS___IS_CLOSED as IS_CLOSED", \
	"FIL_UNCHANGED_RECORDS___INVN_TYPE as INVN_TYPE", \
	"FIL_UNCHANGED_RECORDS___PROD_STAT as PROD_STAT", \
	"FIL_UNCHANGED_RECORDS___BATCH_NBR as BATCH_NBR", \
	"FIL_UNCHANGED_RECORDS___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"FIL_UNCHANGED_RECORDS___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"FIL_UNCHANGED_RECORDS___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"FIL_UNCHANGED_RECORDS___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
    "CASE WHEN TRIM(UPPER(FIL_UNCHANGED_RECORDS___PROC_IMMD_NEEDS)) IN ('Y', '1') THEN '1' ELSE '0' END as PROC_IMMD_NEEDS_EXP", \
    "CASE WHEN TRIM(UPPER(FIL_UNCHANGED_RECORDS___QUALITY_CHECK_HOLD_UPON_RCPT)) IN ('Y', '1') THEN '1' ELSE '0' END as QUALITY_CHECK_HOLD_UPON_RCPT_EXP", \
	"FIL_UNCHANGED_RECORDS___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"FIL_UNCHANGED_RECORDS___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"FIL_UNCHANGED_RECORDS___PUTWY_TYPE as PUTWY_TYPE", \
	"FIL_UNCHANGED_RECORDS___RETAIL_PRICE as RETAIL_PRICE", \
    "CASE WHEN TRIM(UPPER(FIL_UNCHANGED_RECORDS___PRICE_TIX_AVAIL)) IN ('Y', '1') THEN '1' ELSE '0' END as PRICE_TIX_AVAIL_EXP", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___CREATED_SOURCE as CREATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___CREATED_DTTM as CREATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"FIL_UNCHANGED_RECORDS___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"FIL_UNCHANGED_RECORDS___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"FIL_UNCHANGED_RECORDS___TC_COMPANY_ID as TC_COMPANY_ID", \
	"FIL_UNCHANGED_RECORDS___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"FIL_UNCHANGED_RECORDS___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"FIL_UNCHANGED_RECORDS___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"FIL_UNCHANGED_RECORDS___CUT_NBR as CUT_NBR", \
	"FIL_UNCHANGED_RECORDS___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"FIL_UNCHANGED_RECORDS___QTY_UOM_ID as QTY_UOM_ID", \
	"FIL_UNCHANGED_RECORDS___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"FIL_UNCHANGED_RECORDS___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_ID as TC_ORDER_ID", \
	"FIL_UNCHANGED_RECORDS___ORDER_ID as ORDER_ID", \
	"FIL_UNCHANGED_RECORDS___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"FIL_UNCHANGED_RECORDS___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___SEQ_NBR as SEQ_NBR", \
	"FIL_UNCHANGED_RECORDS___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"FIL_UNCHANGED_RECORDS___ASN_RECV_RULES as ASN_RECV_RULES", \
	"FIL_UNCHANGED_RECORDS___CHECKSUM as CHECKSUM", \
	"FIL_UNCHANGED_RECORDS___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_1 as REF_FIELD_1", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_31 as REF_FIELD_31", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_2 as REF_FIELD_2", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_4 as REF_FIELD_4", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_5 as REF_FIELD_5", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_6 as REF_FIELD_6", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_7 as REF_FIELD_7", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_8 as REF_FIELD_8", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_9 as REF_FIELD_9", \
	"FIL_UNCHANGED_RECORDS___REF_FIELD_10 as REF_FIELD_10", \
	"FIL_UNCHANGED_RECORDS___REF_NUM1 as REF_NUM1", \
	"FIL_UNCHANGED_RECORDS___REF_NUM2 as REF_NUM2", \
	"FIL_UNCHANGED_RECORDS___REF_NUM3 as REF_NUM3", \
	"FIL_UNCHANGED_RECORDS___REF_NUM4 as REF_NUM4", \
	"FIL_UNCHANGED_RECORDS___REF_NUM5 as REF_NUM5", \
	"FIL_UNCHANGED_RECORDS___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"FIL_UNCHANGED_RECORDS___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"FIL_UNCHANGED_RECORDS___INV_DISPOSITION as INV_DISPOSITION", \
	"FIL_UNCHANGED_RECORDS___EXT_PLAN_ID as EXT_PLAN_ID", \
	"FIL_UNCHANGED_RECORDS___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"FIL_UNCHANGED_RECORDS___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES", \
	"CURRENT_TIMESTAMP as UPDATE_TSTMP", \
	"IF(FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP IS NULL, CURRENT_TIMESTAMP, FIL_UNCHANGED_RECORDS___i_LOAD_TSTMP) as LOAD_TSTMP", \
	"IF(FIL_UNCHANGED_RECORDS___i_WM_ASN_DETAIL_ID IS NULL, 1, 2) as o_UPDATE_VALIDATOR" \
)

# COMMAND ----------
# Processing node UPD_INS_UPD, type UPDATE_STRATEGY . Note: using additional SELECT to rename incoming columns
# COLUMN COUNT: 103

# for each involved DataFrame, append the dataframe name to each column
EXP_UPD_VALIDATOR_temp = EXP_UPD_VALIDATOR.toDF(*["EXP_UPD_VALIDATOR___" + col for col in EXP_UPD_VALIDATOR.columns])

UPD_INS_UPD = EXP_UPD_VALIDATOR_temp.selectExpr( \
	"EXP_UPD_VALIDATOR___LOCATION_ID as LOCATION_ID", \
	"EXP_UPD_VALIDATOR___ASN_DETAIL_ID as ASN_DETAIL_ID", \
	"EXP_UPD_VALIDATOR___ASN_ID as ASN_ID", \
	"EXP_UPD_VALIDATOR___TC_PURCHASE_ORDERS_ID as TC_PURCHASE_ORDERS_ID", \
	"EXP_UPD_VALIDATOR___PURCHASE_ORDERS_ID as PURCHASE_ORDERS_ID", \
	"EXP_UPD_VALIDATOR___SKU_ID as SKU_ID", \
	"EXP_UPD_VALIDATOR___SKU_NAME as SKU_NAME", \
	"EXP_UPD_VALIDATOR___SKU_ATTR_1 as SKU_ATTR_1", \
	"EXP_UPD_VALIDATOR___SKU_ATTR_2 as SKU_ATTR_2", \
	"EXP_UPD_VALIDATOR___SKU_ATTR_3 as SKU_ATTR_3", \
	"EXP_UPD_VALIDATOR___SKU_ATTR_4 as SKU_ATTR_4", \
	"EXP_UPD_VALIDATOR___SKU_ATTR_5 as SKU_ATTR_5", \
	"EXP_UPD_VALIDATOR___BUSINESS_PARTNER_ID as BUSINESS_PARTNER_ID", \
	"EXP_UPD_VALIDATOR___PACKAGE_TYPE_ID as PACKAGE_TYPE_ID", \
	"EXP_UPD_VALIDATOR___PACKAGE_TYPE_DESC as PACKAGE_TYPE_DESC", \
	"EXP_UPD_VALIDATOR___PACKAGE_TYPE_INSTANCE as PACKAGE_TYPE_INSTANCE", \
	"EXP_UPD_VALIDATOR___EPC_TRACKING_RFID_VALUE as EPC_TRACKING_RFID_VALUE", \
	"EXP_UPD_VALIDATOR___ORDER_TYPE_DESC as ORDER_TYPE_DESC", \
	"EXP_UPD_VALIDATOR___GTIN as GTIN", \
	"EXP_UPD_VALIDATOR___SHIPPED_QTY as SHIPPED_QTY", \
	"EXP_UPD_VALIDATOR___STD_PACK_QTY as STD_PACK_QTY", \
	"EXP_UPD_VALIDATOR___STD_CASE_QTY as STD_CASE_QTY", \
	"EXP_UPD_VALIDATOR___ASN_DETAIL_STATUS as ASN_DETAIL_STATUS", \
	"EXP_UPD_VALIDATOR___RECEIVED_QTY as RECEIVED_QTY", \
	"EXP_UPD_VALIDATOR___STD_SUB_PACK_QTY as STD_SUB_PACK_QTY", \
	"EXP_UPD_VALIDATOR___LPN_PER_TIER as LPN_PER_TIER", \
	"EXP_UPD_VALIDATOR___TIER_PER_PALLET as TIER_PER_PALLET", \
	"EXP_UPD_VALIDATOR___MFG_DATE as MFG_DATE", \
	"EXP_UPD_VALIDATOR___SHIP_BY_DATE as SHIP_BY_DATE", \
	"EXP_UPD_VALIDATOR___MFG_PLNT as MFG_PLNT", \
	"EXP_UPD_VALIDATOR___EXPIRE_DATE as EXPIRE_DATE", \
	"EXP_UPD_VALIDATOR___INCUBATION_DATE as INCUBATION_DATE", \
	"EXP_UPD_VALIDATOR___EPC_REQ_ON_ALL_CASES_EXP as EPC_REQ_ON_ALL_CASES", \
	"EXP_UPD_VALIDATOR___WEIGHT_UOM_ID_BASE as WEIGHT_UOM_ID_BASE", \
	"EXP_UPD_VALIDATOR___REGION_ID as REGION_ID", \
	"EXP_UPD_VALIDATOR___IS_ASSOCIATED_TO_OUTBOUND as IS_ASSOCIATED_TO_OUTBOUND", \
	"EXP_UPD_VALIDATOR___IS_CANCELLED as IS_CANCELLED", \
	"EXP_UPD_VALIDATOR___IS_CLOSED as IS_CLOSED", \
	"EXP_UPD_VALIDATOR___INVN_TYPE as INVN_TYPE", \
	"EXP_UPD_VALIDATOR___PROD_STAT as PROD_STAT", \
	"EXP_UPD_VALIDATOR___BATCH_NBR as BATCH_NBR", \
	"EXP_UPD_VALIDATOR___CNTRY_OF_ORGN as CNTRY_OF_ORGN", \
	"EXP_UPD_VALIDATOR___SHIPPED_LPN_COUNT as SHIPPED_LPN_COUNT", \
	"EXP_UPD_VALIDATOR___RECEIVED_LPN_COUNT as RECEIVED_LPN_COUNT", \
	"EXP_UPD_VALIDATOR___UNITS_ASSIGNED_TO_LPN as UNITS_ASSIGNED_TO_LPN", \
	"EXP_UPD_VALIDATOR___PROC_IMMD_NEEDS_EXP as PROC_IMMD_NEEDS", \
	"EXP_UPD_VALIDATOR___QUALITY_CHECK_HOLD_UPON_RCPT_EXP as QUALITY_CHECK_HOLD_UPON_RCPT", \
	"EXP_UPD_VALIDATOR___REFERENCE_ORDER_NBR as REFERENCE_ORDER_NBR", \
	"EXP_UPD_VALIDATOR___ACTUAL_WEIGHT as ACTUAL_WEIGHT", \
	"EXP_UPD_VALIDATOR___ACTUAL_WEIGHT_PACK_COUNT as ACTUAL_WEIGHT_PACK_COUNT", \
	"EXP_UPD_VALIDATOR___NBR_OF_PACK_FOR_CATCH_WT as NBR_OF_PACK_FOR_CATCH_WT", \
	"EXP_UPD_VALIDATOR___PUTWY_TYPE as PUTWY_TYPE", \
	"EXP_UPD_VALIDATOR___RETAIL_PRICE as RETAIL_PRICE", \
	"EXP_UPD_VALIDATOR___PRICE_TIX_AVAIL_EXP as PRICE_TIX_AVAIL", \
	"EXP_UPD_VALIDATOR___CREATED_SOURCE_TYPE as CREATED_SOURCE_TYPE", \
	"EXP_UPD_VALIDATOR___CREATED_SOURCE as CREATED_SOURCE", \
	"EXP_UPD_VALIDATOR___CREATED_DTTM as CREATED_DTTM", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_SOURCE_TYPE as LAST_UPDATED_SOURCE_TYPE", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_SOURCE as LAST_UPDATED_SOURCE", \
	"EXP_UPD_VALIDATOR___LAST_UPDATED_DTTM as LAST_UPDATED_DTTM", \
	"EXP_UPD_VALIDATOR___HIBERNATE_VERSION as HIBERNATE_VERSION", \
	"EXP_UPD_VALIDATOR___TC_COMPANY_ID as TC_COMPANY_ID", \
	"EXP_UPD_VALIDATOR___TC_PO_LINE_ID as TC_PO_LINE_ID", \
	"EXP_UPD_VALIDATOR___INVENTORY_SEGMENT_ID as INVENTORY_SEGMENT_ID", \
	"EXP_UPD_VALIDATOR___PPACK_GRP_CODE as PPACK_GRP_CODE", \
	"EXP_UPD_VALIDATOR___CUT_NBR as CUT_NBR", \
	"EXP_UPD_VALIDATOR___QTY_CONV_FACTOR as QTY_CONV_FACTOR", \
	"EXP_UPD_VALIDATOR___QTY_UOM_ID as QTY_UOM_ID", \
	"EXP_UPD_VALIDATOR___WEIGHT_UOM_ID as WEIGHT_UOM_ID", \
	"EXP_UPD_VALIDATOR___QTY_UOM_ID_BASE as QTY_UOM_ID_BASE", \
	"EXP_UPD_VALIDATOR___TC_ORDER_ID as TC_ORDER_ID", \
	"EXP_UPD_VALIDATOR___ORDER_ID as ORDER_ID", \
	"EXP_UPD_VALIDATOR___TC_ORDER_LINE_ID as TC_ORDER_LINE_ID", \
	"EXP_UPD_VALIDATOR___ORDER_LINE_ITEM_ID as ORDER_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___SEQ_NBR as SEQ_NBR", \
	"EXP_UPD_VALIDATOR___EXP_RECEIVE_CONDITION_CODE as EXP_RECEIVE_CONDITION_CODE", \
	"EXP_UPD_VALIDATOR___ASN_RECV_RULES as ASN_RECV_RULES", \
	"EXP_UPD_VALIDATOR___CHECKSUM as CHECKSUM", \
	"EXP_UPD_VALIDATOR___ACTUAL_WEIGHT_RECEIVED as ACTUAL_WEIGHT_RECEIVED", \
	"EXP_UPD_VALIDATOR___REF_FIELD_1 as REF_FIELD_1", \
	"EXP_UPD_VALIDATOR___REF_FIELD_31 as REF_FIELD_31", \
	"EXP_UPD_VALIDATOR___REF_FIELD_2 as REF_FIELD_2", \
	"EXP_UPD_VALIDATOR___REF_FIELD_4 as REF_FIELD_4", \
	"EXP_UPD_VALIDATOR___REF_FIELD_5 as REF_FIELD_5", \
	"EXP_UPD_VALIDATOR___REF_FIELD_6 as REF_FIELD_6", \
	"EXP_UPD_VALIDATOR___REF_FIELD_7 as REF_FIELD_7", \
	"EXP_UPD_VALIDATOR___REF_FIELD_8 as REF_FIELD_8", \
	"EXP_UPD_VALIDATOR___REF_FIELD_9 as REF_FIELD_9", \
	"EXP_UPD_VALIDATOR___REF_FIELD_10 as REF_FIELD_10", \
	"EXP_UPD_VALIDATOR___REF_NUM1 as REF_NUM1", \
	"EXP_UPD_VALIDATOR___REF_NUM2 as REF_NUM2", \
	"EXP_UPD_VALIDATOR___REF_NUM3 as REF_NUM3", \
	"EXP_UPD_VALIDATOR___REF_NUM4 as REF_NUM4", \
	"EXP_UPD_VALIDATOR___REF_NUM5 as REF_NUM5", \
	"EXP_UPD_VALIDATOR___DISPOSITION_TYPE as DISPOSITION_TYPE", \
	"EXP_UPD_VALIDATOR___PRE_RECEIPT_STATUS as PRE_RECEIPT_STATUS", \
	"EXP_UPD_VALIDATOR___INV_DISPOSITION as INV_DISPOSITION", \
	"EXP_UPD_VALIDATOR___EXT_PLAN_ID as EXT_PLAN_ID", \
	"EXP_UPD_VALIDATOR___PURCHASE_ORDERS_LINE_ITEM_ID as PURCHASE_ORDERS_LINE_ITEM_ID", \
	"EXP_UPD_VALIDATOR___PROCESSED_FOR_TRLR_MOVES as PROCESSED_FOR_TRLR_MOVES", \
	"EXP_UPD_VALIDATOR___UPDATE_TSTMP as UPDATE_TSTMP", \
	"EXP_UPD_VALIDATOR___LOAD_TSTMP as LOAD_TSTMP", \
	"EXP_UPD_VALIDATOR___o_UPDATE_VALIDATOR as o_UPDATE_VALIDATOR") \
	.withColumn('pyspark_data_action', when(Col('o_UPDATE_VALIDATOR') ==(lit(1)), lit(0)).when(Col('o_UPDATE_VALIDATOR') ==(lit(2)), lit(1)))

# COMMAND ----------
# Processing node Shortcut_to_WM_ASN_DETAIL1, type TARGET 
# COLUMN COUNT: 102


Shortcut_to_WM_ASN_DETAIL1 = UPD_INS_UPD.selectExpr(
	"CAST(LOCATION_ID AS BIGINT) as LOCATION_ID",
	"CAST(ASN_DETAIL_ID AS BIGINT) as WM_ASN_DETAIL_ID",
	"CAST(ASN_ID AS BIGINT) as WM_ASN_ID",
	"CAST(ASN_DETAIL_STATUS AS SMALLINT) as WM_ASN_DETAIL_STATUS",
	"CAST(TC_COMPANY_ID AS INT) as WM_TC_COMPANY_ID",
	"CAST(TC_ORDER_ID AS STRING) as WM_TC_ORDER_ID",
	"CAST(TC_ORDER_LINE_ID AS STRING) as WM_TC_ORDER_LINE_ID",
	"CAST(TC_PURCHASE_ORDERS_ID AS STRING) as WM_TC_PURCHASE_ORDERS_ID",
	"CAST(TC_PO_LINE_ID AS STRING) as WM_TC_PO_LINE_ID",
	"CAST(ORDER_ID AS BIGINT) as WM_ORDER_ID",
	"CAST(ORDER_LINE_ITEM_ID AS BIGINT) as WM_ORDER_LINE_ITEM_ID",
	"CAST(PURCHASE_ORDERS_ID AS BIGINT) as WM_PURCHASE_ORDERS_ID",
	"CAST(PURCHASE_ORDERS_LINE_ITEM_ID AS BIGINT) as WM_PURCHASE_ORDERS_LINE_ITEM_ID",
	"CAST(CUT_NBR AS STRING) as WM_CUT_NBR",
	"CAST(BATCH_NBR AS STRING) as WM_BATCH_NBR",
	"CAST(SEQ_NBR AS STRING) as WM_SEQ_NBR",
	"CAST(ORDER_TYPE_DESC AS STRING) as WM_ORDER_TYPE_DESC",
	"CAST(REFERENCE_ORDER_NBR AS STRING) as WM_REFERENCE_ORDER_NBR",
	"CAST(BUSINESS_PARTNER_ID AS STRING) as WM_BUSINESS_PARTNER_ID",
	"CAST(PACKAGE_TYPE_ID AS INT) as WM_PACKAGE_TYPE_ID",
	"CAST(PACKAGE_TYPE_DESC AS STRING) as WM_PACKAGE_TYPE_DESC",
	"CAST(PACKAGE_TYPE_INSTANCE AS STRING) as WM_PACKAGE_TYPE_INSTANCE",
	"CAST(EPC_TRACKING_RFID_VALUE AS STRING) as WM_EPC_TRACKING_RFID_VALUE",
	"CAST(PRE_RECEIPT_STATUS AS STRING) as WM_PRE_RECEIPT_STATUS",
	"CAST(INVN_TYPE AS STRING) as WM_INVN_TYPE",
	"CAST(PUTWY_TYPE AS STRING) as WM_PUTWY_TYPE",
	"CAST(PROD_STAT AS STRING) as WM_PROD_STAT",
	"CAST(MFG_PLNT AS STRING) as MFG_PLNT",
	"CAST(REGION_ID AS INT) as WM_REGION_ID",
	"CAST(CNTRY_OF_ORGN AS STRING) as COUNTRY_OF_ORIGIN",
	"CAST(INVENTORY_SEGMENT_ID AS BIGINT) as WM_INVENTORY_SEGMENT_ID",
	"CAST(INV_DISPOSITION AS STRING) as WM_INV_DISPOSITION",
	"CAST(PPACK_GRP_CODE AS STRING) as WM_PPACK_GRP_CD",
	"CAST(EXP_RECEIVE_CONDITION_CODE AS STRING) as WM_EXP_RECEIVE_CONDITION_CD",
	"CAST(ASN_RECV_RULES AS STRING) as ASN_RECV_RULES",
	"CAST(DISPOSITION_TYPE AS STRING) as WM_DISPOSITION_TYPE",
	"CAST(EXT_PLAN_ID AS STRING) as WM_EXT_PLAN_ID",
	"CAST(MFG_DATE AS TIMESTAMP) as MANUFACTURING_TSTMP",
	"CAST(SHIP_BY_DATE AS TIMESTAMP) as SHIP_BY_TSTMP",
	"CAST(EXPIRE_DATE AS TIMESTAMP) as EXPIRE_TSTMP",
	"CAST(INCUBATION_DATE AS TIMESTAMP) as INCUBATION_TSTMP",
	"CAST(EPC_REQ_ON_ALL_CASES AS TINYINT) as EPC_REQ_ON_ALL_CASES_FLAG",
	"CAST(IS_ASSOCIATED_TO_OUTBOUND AS TINYINT) as ASSOCIATED_TO_OUTBOUND_FLAG",
	"CAST(PROCESSED_FOR_TRLR_MOVES AS TINYINT) as WM_PROCESSED_FOR_TRLR_MOVES_FLAG",
	"CAST(PROC_IMMD_NEEDS AS TINYINT) as PROCESS_IMMEDIATE_NEEDS_FLAG",
	"CAST(QUALITY_CHECK_HOLD_UPON_RCPT AS TINYINT) as QUALITY_CHECK_HOLD_UPON_RCPT_FLAG",
	"CAST(PRICE_TIX_AVAIL AS TINYINT) as PRICE_TIX_AVAIL_FLAG",
	"CAST(SKU_ID AS INT) as WM_SKU_ID",
	"CAST(SKU_NAME AS STRING) as WM_SKU_NAME",
	"CAST(GTIN AS STRING) as GTIN",
	"CAST(SKU_ATTR_1 AS STRING) as WM_SKU_ATTR_1",
	"CAST(SKU_ATTR_2 AS STRING) as WM_SKU_ATTR_2",
	"CAST(SKU_ATTR_3 AS STRING) as WM_SKU_ATTR_3",
	"CAST(SKU_ATTR_4 AS STRING) as WM_SKU_ATTR_4",
	"CAST(SKU_ATTR_5 AS STRING) as WM_SKU_ATTR_5",
	"CAST(RETAIL_PRICE AS DECIMAL(16,4)) as RETAIL_PRICE",
	"CAST(UNITS_ASSIGNED_TO_LPN AS DECIMAL(16,4)) as UNITS_ASSIGNED_TO_LPN",
	"CAST(SHIPPED_LPN_COUNT AS INT) as SHIPPED_LPN_CNT",
	"CAST(RECEIVED_LPN_COUNT AS INT) as RECEIVED_LPN_CNT",
	"CAST(SHIPPED_QTY AS DECIMAL(16,4)) as SHIPPED_QTY",
	"CAST(RECEIVED_QTY AS DECIMAL(16,4)) as RECEIVED_QTY",
	"CAST(STD_PACK_QTY AS DECIMAL(13,4)) as STD_PACK_QTY",
	"CAST(STD_CASE_QTY AS DECIMAL(16,4)) as STD_CASE_QTY",
	"CAST(STD_SUB_PACK_QTY AS DECIMAL(13,4)) as STD_SUB_PACK_QTY",
	"CAST(QTY_CONV_FACTOR AS DECIMAL(17,8)) as QTY_CONV_FACTOR",
	"CAST(QTY_UOM_ID AS BIGINT) as WM_QTY_UOM_ID",
	"CAST(QTY_UOM_ID_BASE AS INT) as WM_QTY_UOM_ID_BASE",
	"CAST(ACTUAL_WEIGHT AS DECIMAL(13,4)) as ACTUAL_WEIGHT",
	"CAST(ACTUAL_WEIGHT_RECEIVED AS DECIMAL(16,4)) as ACTUAL_WEIGHT_RECEIVED",
	"CAST(ACTUAL_WEIGHT_PACK_COUNT AS DECIMAL(13,4)) as ACTUAL_WEIGHT_PACK_CNT",
	"CAST(NBR_OF_PACK_FOR_CATCH_WT AS DECIMAL(13,4)) as NBR_OF_PACK_FOR_CATCH_WT",
	"CAST(WEIGHT_UOM_ID AS INT) as WM_WEIGHT_UOM_ID",
	"CAST(WEIGHT_UOM_ID_BASE AS INT) as WM_WEIGHT_UOM_ID_BASE",
	"CAST(LPN_PER_TIER AS INT) as LPN_PER_TIER",
	"CAST(TIER_PER_PALLET AS INT) as TIER_PER_PALLET",
	"CAST(CHECKSUM AS STRING) as CHECKSUM",
	"CAST(IS_CANCELLED AS TINYINT) as CANCELLED_FLAG",
	"CAST(IS_CLOSED AS TINYINT) as CLOSED_FLAG",
	"CAST(REF_FIELD_1 AS STRING) as REF_FIELD_1",
	"CAST(REF_FIELD_2 AS STRING) as REF_FIELD_2",
	"CAST(REF_FIELD_31 AS STRING) as REF_FIELD_3",
	"CAST(REF_FIELD_4 AS STRING) as REF_FIELD_4",
	"CAST(REF_FIELD_5 AS STRING) as REF_FIELD_5",
	"CAST(REF_FIELD_6 AS STRING) as REF_FIELD_6",
	"CAST(REF_FIELD_7 AS STRING) as REF_FIELD_7",
	"CAST(REF_FIELD_8 AS STRING) as REF_FIELD_8",
	"CAST(REF_FIELD_9 AS STRING) as REF_FIELD_9",
	"CAST(REF_FIELD_10 AS STRING) as REF_FIELD_10",
	"CAST(REF_NUM1 AS DECIMAL(13,5)) as REF_NUM_1",
	"CAST(REF_NUM2 AS DECIMAL(13,5)) as REF_NUM_2",
	"CAST(REF_NUM3 AS DECIMAL(13,5)) as REF_NUM_3",
	"CAST(REF_NUM4 AS DECIMAL(13,5)) as REF_NUM_4",
	"CAST(REF_NUM5 AS DECIMAL(13,5)) as REF_NUM_5",
	"CAST(HIBERNATE_VERSION AS BIGINT) as WM_HIBERNATE_VERSION",
	"CAST(CREATED_SOURCE_TYPE AS TINYINT) as WM_CREATED_SOURCE_TYPE",
	"CAST(CREATED_SOURCE AS STRING) as WM_CREATED_SOURCE",
	"CAST(CREATED_DTTM AS TIMESTAMP) as WM_CREATED_TSTMP",
	"CAST(LAST_UPDATED_SOURCE_TYPE AS TINYINT) as WM_LAST_UPDATED_SOURCE_TYPE",
	"CAST(LAST_UPDATED_SOURCE AS STRING) as WM_LAST_UPDATED_SOURCE",
	"CAST(LAST_UPDATED_DTTM AS TIMESTAMP) as WM_LAST_UPDATED_TSTMP",
	"CAST(UPDATE_TSTMP AS TIMESTAMP) as UPDATE_TSTMP",
	"CAST(LOAD_TSTMP AS TIMESTAMP) as LOAD_TSTMP", 
    "pyspark_data_action" 
)

try:
  primary_key = """source.LOCATION_ID = target.LOCATION_ID AND source.WM_ASN_DETAIL_ID = target.WM_ASN_DETAIL_ID"""
#   refined_perf_table = "WM_ASN_DETAIL"
  executeMerge(Shortcut_to_WM_ASN_DETAIL1, refined_perf_table, primary_key)
  logger.info(f"Merge with {refined_perf_table} completed]")
  logPrevRunDt("WM_ASN_DETAIL", "WM_ASN_DETAIL", "Completed", "N/A", f"{raw}.log_run_details")
except Exception as e:
  logPrevRunDt("WM_ASN_DETAIL", "WM_ASN_DETAIL","Failed",str(e), f"{raw}.log_run_details", )
  raise e
	